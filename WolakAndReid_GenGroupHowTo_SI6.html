<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="data:text/css,%0A%0A%40font%2Dface%20%7B%0A%20%20font%2Dfamily%3A%20octicons%2Dlink%3B%0A%20%20src%3A%20url%28data%3Afont%2Fwoff%3Bcharset%3Dutf%2D8%3Bbase64%3Bbase64%2Cd09GRgABAAAAAAZwABAAAAAACFQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEU0lHAAAGaAAAAAgAAAAIAAAAAUdTVUIAAAZcAAAACgAAAAoAAQAAT1MvMgAAAyQAAABJAAAAYFYEU3RjbWFwAAADcAAAAEUAAACAAJThvmN2dCAAAATkAAAABAAAAAQAAAAAZnBnbQAAA7gAAACyAAABCUM%2B8IhnYXNwAAAGTAAAABAAAAAQABoAI2dseWYAAAFsAAABPAAAAZwcEq9taGVhZAAAAsgAAAA0AAAANgh4a91oaGVhAAADCAAAABoAAAAkCA8DRGhtdHgAAAL8AAAADAAAAAwGAACfbG9jYQAAAsAAAAAIAAAACABiATBtYXhwAAACqAAAABgAAAAgAA8ASm5hbWUAAAToAAABQgAAAlXu73sOcG9zdAAABiwAAAAeAAAAME3QpOBwcmVwAAAEbAAAAHYAAAB%2FaFGpk3jaTY6xa8JAGMW%2FO62BDi0tJLYQincXEypYIiGJjSgHniQ6umTsUEyLm5BV6NDBP8Tpts6F0v%2Bk%2F0an2i%2BitHDw3v2%2B9%2BDBKTzsJNnWJNTgHEy4BgG3EMI9DCEDOGEXzDADU5hBKMIgNPZqoD3SilVaXZCER3%2FI7AtxEJLtzzuZfI%2BVVkprxTlXShWKb3TBecG11rwoNlmmn1P2WYcJczl32etSpKnziC7lQyWe1smVPy%2FLt7Kc%2B0vWY%2FgAgIIEqAN9we0pwKXreiMasxvabDQMM4riO%2BqxM2ogwDGOZTXxwxDiycQIcoYFBLj5K3EIaSctAq2kTYiw%2Bymhce7vwM9jSqO8JyVd5RH9gyTt2%2BJ%2FyUmYlIR0s04n6%2B7Vm1ozezUeLEaUjhaDSuXHwVRgvLJn1tQ7xiuVv%2FocTRF42mNgZGBgYGbwZOBiAAFGJBIMAAizAFoAAABiAGIAznjaY2BkYGAA4in8zwXi%2BW2%2BMjCzMIDApSwvXzC97Z4Ig8N%2FBxYGZgcgl52BCSQKAA3jCV8CAABfAAAAAAQAAEB42mNgZGBg4f3vACQZQABIMjKgAmYAKEgBXgAAeNpjYGY6wTiBgZWBg2kmUxoDA4MPhGZMYzBi1AHygVLYQUCaawqDA4PChxhmh%2F8ODDEsvAwHgMKMIDnGL0x7gJQCAwMAJd4MFwAAAHjaY2BgYGaA4DAGRgYQkAHyGMF8NgYrIM3JIAGVYYDT%2BAEjAwuDFpBmA9KMDEwMCh9i%2Fv8H8sH0%2F4dQc1iAmAkALaUKLgAAAHjaTY9LDsIgEIbtgqHUPpDi3gPoBVyRTmTddOmqTXThEXqrob2gQ1FjwpDvfwCBdmdXC5AVKFu3e5MfNFJ29KTQT48Ob9%2FlqYwOGZxeUelN2U2R6%2BcArgtCJpauW7UQBqnFkUsjAY%2FkOU1cP%2BDAgvxwn1chZDwUbd6CFimGXwzwF6tPbFIcjEl%2BvvmM%2FbyA48e6tWrKArm4ZJlCbdsrxksL1AwWn%2FyBSJKpYbq8AXaaTb8AAHja28jAwOC00ZrBeQNDQOWO%2F%2FsdBBgYGRiYWYAEELEwMTE4uzo5Zzo5b2BxdnFOcALxNjA6b2ByTswC8jYwg0VlNuoCTWAMqNzMzsoK1rEhNqByEyerg5PMJlYuVueETKcd%2F89uBpnpvIEVomeHLoMsAAe1Id4AAAAAAAB42oWQT07CQBTGv0JBhagk7HQzKxca2sJCE1hDt4QF%2B9JOS0nbaaYDCQfwCJ7Au3AHj%2BLO13FMmm6cl7785vven0kBjHCBhfpYuNa5Ph1c0e2Xu3jEvWG7UdPDLZ4N92nOm%2BEBXuAbHmIMSRMs%2B4aUEd4Nd3CHD8NdvOLTsA2GL8M9PODbcL%2BhD7C1xoaHeLJSEao0FEW14ckxC%2BTU8TxvsY6X0eLPmRhry2WVioLpkrbp84LLQPGI7c6sOiUzpWIWS5GzlSgUzzLBSikOPFTOXqly7rqx0Z1Q5BAIoZBSFihQYQOOBEdkCOgXTOHA07HAGjGWiIjaPZNW13%2F%2Blm6S9FT7rLHFJ6fQbkATOG1j2OFMucKJJsxIVfQORl%2B9Jyda6Sl1dUYhSCm1dyClfoeDve4qMYdLEbfqHf3O%2FAdDumsjAAB42mNgYoAAZQYjBmyAGYQZmdhL8zLdDEydARfoAqIAAAABAAMABwAKABMAB%2F%2F%2FAA8AAQAAAAAAAAAAAAAAAAABAAAAAA%3D%3D%29%20format%28%27woff%27%29%3B%0A%7D%0A%0Abody%20%7B%0A%20%20%2Dwebkit%2Dtext%2Dsize%2Dadjust%3A%20100%25%3B%0A%20%20text%2Dsize%2Dadjust%3A%20100%25%3B%0A%20%20color%3A%20%23333%3B%0A%20%20font%2Dfamily%3A%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20%22Segoe%20UI%22%2C%20Arial%2C%20freesans%2C%20sans%2Dserif%2C%20%22Apple%20Color%20Emoji%22%2C%20%22Segoe%20UI%20Emoji%22%2C%20%22Segoe%20UI%20Symbol%22%3B%0A%20%20font%2Dsize%3A%2016px%3B%0A%20%20line%2Dheight%3A%201%2E6%3B%0A%20%20word%2Dwrap%3A%20break%2Dword%3B%0A%7D%0A%0Aa%20%7B%0A%20%20background%2Dcolor%3A%20transparent%3B%0A%7D%0A%0Aa%3Aactive%2C%0Aa%3Ahover%20%7B%0A%20%20outline%3A%200%3B%0A%7D%0A%0Astrong%20%7B%0A%20%20font%2Dweight%3A%20bold%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20font%2Dsize%3A%202em%3B%0A%20%20margin%3A%200%2E67em%200%3B%0A%7D%0A%0Aimg%20%7B%0A%20%20border%3A%200%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20box%2Dsizing%3A%20content%2Dbox%3B%0A%20%20height%3A%200%3B%0A%7D%0A%0Apre%20%7B%0A%20%20overflow%3A%20auto%3B%0A%7D%0A%0Acode%2C%0Akbd%2C%0Apre%20%7B%0A%20%20font%2Dfamily%3A%20monospace%2C%20monospace%3B%0A%20%20font%2Dsize%3A%201em%3B%0A%7D%0A%0Ainput%20%7B%0A%20%20color%3A%20inherit%3B%0A%20%20font%3A%20inherit%3B%0A%20%20margin%3A%200%3B%0A%7D%0A%0Ahtml%20input%5Bdisabled%5D%20%7B%0A%20%20cursor%3A%20default%3B%0A%7D%0A%0Ainput%20%7B%0A%20%20line%2Dheight%3A%20normal%3B%0A%7D%0A%0Ainput%5Btype%3D%22checkbox%22%5D%20%7B%0A%20%20box%2Dsizing%3A%20border%2Dbox%3B%0A%20%20padding%3A%200%3B%0A%7D%0A%0Atable%20%7B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%20%20border%2Dspacing%3A%200%3B%0A%7D%0A%0Atd%2C%0Ath%20%7B%0A%20%20padding%3A%200%3B%0A%7D%0A%0A%2A%20%7B%0A%20%20box%2Dsizing%3A%20border%2Dbox%3B%0A%7D%0A%0Ainput%20%7B%0A%20%20font%3A%2013px%20%2F%201%2E4%20Helvetica%2C%20arial%2C%20nimbussansl%2C%20liberationsans%2C%20freesans%2C%20clean%2C%20sans%2Dserif%2C%20%22Apple%20Color%20Emoji%22%2C%20%22Segoe%20UI%20Emoji%22%2C%20%22Segoe%20UI%20Symbol%22%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%234078c0%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%0Aa%3Ahover%2C%0Aa%3Aactive%20%7B%0A%20%20text%2Ddecoration%3A%20underline%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20height%3A%200%3B%0A%20%20margin%3A%2015px%200%3B%0A%20%20overflow%3A%20hidden%3B%0A%20%20background%3A%20transparent%3B%0A%20%20border%3A%200%3B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ddd%3B%0A%7D%0A%0Ahr%3Abefore%20%7B%0A%20%20display%3A%20table%3B%0A%20%20content%3A%20%22%22%3B%0A%7D%0A%0Ahr%3Aafter%20%7B%0A%20%20display%3A%20table%3B%0A%20%20clear%3A%20both%3B%0A%20%20content%3A%20%22%22%3B%0A%7D%0A%0Ah1%2C%0Ah2%2C%0Ah3%2C%0Ah4%2C%0Ah5%2C%0Ah6%20%7B%0A%20%20margin%2Dtop%3A%2015px%3B%0A%20%20margin%2Dbottom%3A%2015px%3B%0A%20%20line%2Dheight%3A%201%2E1%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20font%2Dsize%3A%2030px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20font%2Dsize%3A%2021px%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20font%2Dsize%3A%2016px%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20font%2Dsize%3A%2014px%3B%0A%7D%0A%0Ah5%20%7B%0A%20%20font%2Dsize%3A%2012px%3B%0A%7D%0A%0Ah6%20%7B%0A%20%20font%2Dsize%3A%2011px%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20margin%3A%200%3B%0A%7D%0A%0Aul%2C%0Aol%20%7B%0A%20%20padding%3A%200%3B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20margin%2Dbottom%3A%200%3B%0A%7D%0A%0Aol%20ol%2C%0Aul%20ol%20%7B%0A%20%20list%2Dstyle%2Dtype%3A%20lower%2Droman%3B%0A%7D%0A%0Aul%20ul%20ol%2C%0Aul%20ol%20ol%2C%0Aol%20ul%20ol%2C%0Aol%20ol%20ol%20%7B%0A%20%20list%2Dstyle%2Dtype%3A%20lower%2Dalpha%3B%0A%7D%0A%0Add%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20%22Liberation%20Mono%22%2C%20Menlo%2C%20Courier%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2012px%3B%0A%7D%0A%0Apre%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20margin%2Dbottom%3A%200%3B%0A%20%20font%3A%2012px%20Consolas%2C%20%22Liberation%20Mono%22%2C%20Menlo%2C%20Courier%2C%20monospace%3B%0A%7D%0A%0A%2Eselect%3A%3A%2Dms%2Dexpand%20%7B%0A%20%20opacity%3A%200%3B%0A%7D%0A%0A%2Eocticon%20%7B%0A%20%20font%3A%20normal%20normal%20normal%2016px%2F1%20octicons%2Dlink%3B%0A%20%20display%3A%20inline%2Dblock%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%20%20text%2Drendering%3A%20auto%3B%0A%20%20%2Dwebkit%2Dfont%2Dsmoothing%3A%20antialiased%3B%0A%20%20%2Dmoz%2Dosx%2Dfont%2Dsmoothing%3A%20grayscale%3B%0A%20%20%2Dwebkit%2Duser%2Dselect%3A%20none%3B%0A%20%20%2Dmoz%2Duser%2Dselect%3A%20none%3B%0A%20%20%2Dms%2Duser%2Dselect%3A%20none%3B%0A%20%20user%2Dselect%3A%20none%3B%0A%7D%0A%0A%2Eocticon%2Dlink%3Abefore%20%7B%0A%20%20content%3A%20%27%5Cf05c%27%3B%0A%7D%0A%0A%2Emarkdown%2Dbody%3Abefore%20%7B%0A%20%20display%3A%20table%3B%0A%20%20content%3A%20%22%22%3B%0A%7D%0A%0A%2Emarkdown%2Dbody%3Aafter%20%7B%0A%20%20display%3A%20table%3B%0A%20%20clear%3A%20both%3B%0A%20%20content%3A%20%22%22%3B%0A%7D%0A%0A%2Emarkdown%2Dbody%3E%2A%3Afirst%2Dchild%20%7B%0A%20%20margin%2Dtop%3A%200%20%21important%3B%0A%7D%0A%0A%2Emarkdown%2Dbody%3E%2A%3Alast%2Dchild%20%7B%0A%20%20margin%2Dbottom%3A%200%20%21important%3B%0A%7D%0A%0Aa%3Anot%28%5Bhref%5D%29%20%7B%0A%20%20color%3A%20inherit%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%0A%2Eanchor%20%7B%0A%20%20display%3A%20inline%2Dblock%3B%0A%20%20padding%2Dright%3A%202px%3B%0A%20%20margin%2Dleft%3A%20%2D18px%3B%0A%7D%0A%0A%2Eanchor%3Afocus%20%7B%0A%20%20outline%3A%20none%3B%0A%7D%0A%0Ah1%2C%0Ah2%2C%0Ah3%2C%0Ah4%2C%0Ah5%2C%0Ah6%20%7B%0A%20%20margin%2Dtop%3A%201em%3B%0A%20%20margin%2Dbottom%3A%2016px%3B%0A%20%20font%2Dweight%3A%20bold%3B%0A%20%20line%2Dheight%3A%201%2E4%3B%0A%7D%0A%0Ah1%20%2Eocticon%2Dlink%2C%0Ah2%20%2Eocticon%2Dlink%2C%0Ah3%20%2Eocticon%2Dlink%2C%0Ah4%20%2Eocticon%2Dlink%2C%0Ah5%20%2Eocticon%2Dlink%2C%0Ah6%20%2Eocticon%2Dlink%20%7B%0A%20%20color%3A%20%23000%3B%0A%20%20vertical%2Dalign%3A%20middle%3B%0A%20%20visibility%3A%20hidden%3B%0A%7D%0A%0Ah1%3Ahover%20%2Eanchor%2C%0Ah2%3Ahover%20%2Eanchor%2C%0Ah3%3Ahover%20%2Eanchor%2C%0Ah4%3Ahover%20%2Eanchor%2C%0Ah5%3Ahover%20%2Eanchor%2C%0Ah6%3Ahover%20%2Eanchor%20%7B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%0Ah1%3Ahover%20%2Eanchor%20%2Eocticon%2Dlink%2C%0Ah2%3Ahover%20%2Eanchor%20%2Eocticon%2Dlink%2C%0Ah3%3Ahover%20%2Eanchor%20%2Eocticon%2Dlink%2C%0Ah4%3Ahover%20%2Eanchor%20%2Eocticon%2Dlink%2C%0Ah5%3Ahover%20%2Eanchor%20%2Eocticon%2Dlink%2C%0Ah6%3Ahover%20%2Eanchor%20%2Eocticon%2Dlink%20%7B%0A%20%20visibility%3A%20visible%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20padding%2Dbottom%3A%200%2E3em%3B%0A%20%20font%2Dsize%3A%202%2E25em%3B%0A%20%20line%2Dheight%3A%201%2E2%3B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23eee%3B%0A%7D%0A%0Ah1%20%2Eanchor%20%7B%0A%20%20line%2Dheight%3A%201%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20padding%2Dbottom%3A%200%2E3em%3B%0A%20%20font%2Dsize%3A%201%2E75em%3B%0A%20%20line%2Dheight%3A%201%2E225%3B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23eee%3B%0A%7D%0A%0Ah2%20%2Eanchor%20%7B%0A%20%20line%2Dheight%3A%201%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20font%2Dsize%3A%201%2E5em%3B%0A%20%20line%2Dheight%3A%201%2E43%3B%0A%7D%0A%0Ah3%20%2Eanchor%20%7B%0A%20%20line%2Dheight%3A%201%2E2%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20font%2Dsize%3A%201%2E25em%3B%0A%7D%0A%0Ah4%20%2Eanchor%20%7B%0A%20%20line%2Dheight%3A%201%2E2%3B%0A%7D%0A%0Ah5%20%7B%0A%20%20font%2Dsize%3A%201em%3B%0A%7D%0A%0Ah5%20%2Eanchor%20%7B%0A%20%20line%2Dheight%3A%201%2E1%3B%0A%7D%0A%0Ah6%20%7B%0A%20%20font%2Dsize%3A%201em%3B%0A%20%20color%3A%20%23777%3B%0A%7D%0A%0Ah6%20%2Eanchor%20%7B%0A%20%20line%2Dheight%3A%201%2E1%3B%0A%7D%0A%0Ap%2C%0Ablockquote%2C%0Aul%2C%0Aol%2C%0Adl%2C%0Atable%2C%0Apre%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20margin%2Dbottom%3A%2016px%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20height%3A%204px%3B%0A%20%20padding%3A%200%3B%0A%20%20margin%3A%2016px%200%3B%0A%20%20background%2Dcolor%3A%20%23e7e7e7%3B%0A%20%20border%3A%200%20none%3B%0A%7D%0A%0Aul%2C%0Aol%20%7B%0A%20%20padding%2Dleft%3A%202em%3B%0A%7D%0A%0Aul%20ul%2C%0Aul%20ol%2C%0Aol%20ol%2C%0Aol%20ul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20margin%2Dbottom%3A%200%3B%0A%7D%0A%0Ali%3Ep%20%7B%0A%20%20margin%2Dtop%3A%2016px%3B%0A%7D%0A%0Adl%20%7B%0A%20%20padding%3A%200%3B%0A%7D%0A%0Adl%20dt%20%7B%0A%20%20padding%3A%200%3B%0A%20%20margin%2Dtop%3A%2016px%3B%0A%20%20font%2Dsize%3A%201em%3B%0A%20%20font%2Dstyle%3A%20italic%3B%0A%20%20font%2Dweight%3A%20bold%3B%0A%7D%0A%0Adl%20dd%20%7B%0A%20%20padding%3A%200%2016px%3B%0A%20%20margin%2Dbottom%3A%2016px%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20padding%3A%200%2015px%3B%0A%20%20color%3A%20%23777%3B%0A%20%20border%2Dleft%3A%204px%20solid%20%23ddd%3B%0A%7D%0A%0Ablockquote%3E%3Afirst%2Dchild%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%0Ablockquote%3E%3Alast%2Dchild%20%7B%0A%20%20margin%2Dbottom%3A%200%3B%0A%7D%0A%0Atable%20%7B%0A%20%20display%3A%20block%3B%0A%20%20width%3A%20100%25%3B%0A%20%20overflow%3A%20auto%3B%0A%20%20word%2Dbreak%3A%20normal%3B%0A%20%20word%2Dbreak%3A%20keep%2Dall%3B%0A%7D%0A%0Atable%20th%20%7B%0A%20%20font%2Dweight%3A%20bold%3B%0A%7D%0A%0Atable%20th%2C%0Atable%20td%20%7B%0A%20%20padding%3A%206px%2013px%3B%0A%20%20border%3A%201px%20solid%20%23ddd%3B%0A%7D%0A%0Atable%20tr%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23ccc%3B%0A%7D%0A%0Atable%20tr%3Anth%2Dchild%282n%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f8f8f8%3B%0A%7D%0A%0Aimg%20%7B%0A%20%20max%2Dwidth%3A%20100%25%3B%0A%20%20box%2Dsizing%3A%20content%2Dbox%3B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%7D%0A%0Acode%20%7B%0A%20%20padding%3A%200%3B%0A%20%20padding%2Dtop%3A%200%2E2em%3B%0A%20%20padding%2Dbottom%3A%200%2E2em%3B%0A%20%20margin%3A%200%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%20%20background%2Dcolor%3A%20rgba%280%2C0%2C0%2C0%2E04%29%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%7D%0A%0Acode%3Abefore%2C%0Acode%3Aafter%20%7B%0A%20%20letter%2Dspacing%3A%20%2D0%2E2em%3B%0A%20%20content%3A%20%22%5C00a0%22%3B%0A%7D%0A%0Apre%3Ecode%20%7B%0A%20%20padding%3A%200%3B%0A%20%20margin%3A%200%3B%0A%20%20font%2Dsize%3A%20100%25%3B%0A%20%20word%2Dbreak%3A%20normal%3B%0A%20%20white%2Dspace%3A%20pre%3B%0A%20%20background%3A%20transparent%3B%0A%20%20border%3A%200%3B%0A%7D%0A%0A%2Ehighlight%20%7B%0A%20%20margin%2Dbottom%3A%2016px%3B%0A%7D%0A%0A%2Ehighlight%20pre%2C%0Apre%20%7B%0A%20%20padding%3A%2016px%3B%0A%20%20overflow%3A%20auto%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%20%20line%2Dheight%3A%201%2E45%3B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%7D%0A%0A%2Ehighlight%20pre%20%7B%0A%20%20margin%2Dbottom%3A%200%3B%0A%20%20word%2Dbreak%3A%20normal%3B%0A%7D%0A%0Apre%20%7B%0A%20%20word%2Dwrap%3A%20normal%3B%0A%7D%0A%0Apre%20code%20%7B%0A%20%20display%3A%20inline%3B%0A%20%20max%2Dwidth%3A%20initial%3B%0A%20%20padding%3A%200%3B%0A%20%20margin%3A%200%3B%0A%20%20overflow%3A%20initial%3B%0A%20%20line%2Dheight%3A%20inherit%3B%0A%20%20word%2Dwrap%3A%20normal%3B%0A%20%20background%2Dcolor%3A%20transparent%3B%0A%20%20border%3A%200%3B%0A%7D%0A%0Apre%20code%3Abefore%2C%0Apre%20code%3Aafter%20%7B%0A%20%20content%3A%20normal%3B%0A%7D%0A%0Akbd%20%7B%0A%20%20display%3A%20inline%2Dblock%3B%0A%20%20padding%3A%203px%205px%3B%0A%20%20font%2Dsize%3A%2011px%3B%0A%20%20line%2Dheight%3A%2010px%3B%0A%20%20color%3A%20%23555%3B%0A%20%20vertical%2Dalign%3A%20middle%3B%0A%20%20background%2Dcolor%3A%20%23fcfcfc%3B%0A%20%20border%3A%20solid%201px%20%23ccc%3B%0A%20%20border%2Dbottom%2Dcolor%3A%20%23bbb%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20box%2Dshadow%3A%20inset%200%20%2D1px%200%20%23bbb%3B%0A%7D%0A%0A%2Epl%2Dc%20%7B%0A%20%20color%3A%20%23969896%3B%0A%7D%0A%0A%2Epl%2Dc1%2C%0A%2Epl%2Ds%20%2Epl%2Dv%20%7B%0A%20%20color%3A%20%230086b3%3B%0A%7D%0A%0A%2Epl%2De%2C%0A%2Epl%2Den%20%7B%0A%20%20color%3A%20%23795da3%3B%0A%7D%0A%0A%2Epl%2Ds%20%2Epl%2Ds1%2C%0A%2Epl%2Dsmi%20%7B%0A%20%20color%3A%20%23333%3B%0A%7D%0A%0A%2Epl%2Dent%20%7B%0A%20%20color%3A%20%2363a35c%3B%0A%7D%0A%0A%2Epl%2Dk%20%7B%0A%20%20color%3A%20%23a71d5d%3B%0A%7D%0A%0A%2Epl%2Dpds%2C%0A%2Epl%2Ds%2C%0A%2Epl%2Ds%20%2Epl%2Dpse%20%2Epl%2Ds1%2C%0A%2Epl%2Dsr%2C%0A%2Epl%2Dsr%20%2Epl%2Dcce%2C%0A%2Epl%2Dsr%20%2Epl%2Dsra%2C%0A%2Epl%2Dsr%20%2Epl%2Dsre%20%7B%0A%20%20color%3A%20%23183691%3B%0A%7D%0A%0A%2Epl%2Dv%20%7B%0A%20%20color%3A%20%23ed6a43%3B%0A%7D%0A%0A%2Epl%2Did%20%7B%0A%20%20color%3A%20%23b52a1d%3B%0A%7D%0A%0A%2Epl%2Dii%20%7B%0A%20%20background%2Dcolor%3A%20%23b52a1d%3B%0A%20%20color%3A%20%23f8f8f8%3B%0A%7D%0A%0A%2Epl%2Dsr%20%2Epl%2Dcce%20%7B%0A%20%20color%3A%20%2363a35c%3B%0A%20%20font%2Dweight%3A%20bold%3B%0A%7D%0A%0A%2Epl%2Dml%20%7B%0A%20%20color%3A%20%23693a17%3B%0A%7D%0A%0A%2Epl%2Dmh%2C%0A%2Epl%2Dmh%20%2Epl%2Den%2C%0A%2Epl%2Dms%20%7B%0A%20%20color%3A%20%231d3e81%3B%0A%20%20font%2Dweight%3A%20bold%3B%0A%7D%0A%0A%2Epl%2Dmq%20%7B%0A%20%20color%3A%20%23008080%3B%0A%7D%0A%0A%2Epl%2Dmi%20%7B%0A%20%20color%3A%20%23333%3B%0A%20%20font%2Dstyle%3A%20italic%3B%0A%7D%0A%0A%2Epl%2Dmb%20%7B%0A%20%20color%3A%20%23333%3B%0A%20%20font%2Dweight%3A%20bold%3B%0A%7D%0A%0A%2Epl%2Dmd%20%7B%0A%20%20background%2Dcolor%3A%20%23ffecec%3B%0A%20%20color%3A%20%23bd2c00%3B%0A%7D%0A%0A%2Epl%2Dmi1%20%7B%0A%20%20background%2Dcolor%3A%20%23eaffea%3B%0A%20%20color%3A%20%2355a532%3B%0A%7D%0A%0A%2Epl%2Dmdr%20%7B%0A%20%20color%3A%20%23795da3%3B%0A%20%20font%2Dweight%3A%20bold%3B%0A%7D%0A%0A%2Epl%2Dmo%20%7B%0A%20%20color%3A%20%231d3e81%3B%0A%7D%0A%0Akbd%20%7B%0A%20%20display%3A%20inline%2Dblock%3B%0A%20%20padding%3A%203px%205px%3B%0A%20%20font%3A%2011px%20Consolas%2C%20%22Liberation%20Mono%22%2C%20Menlo%2C%20Courier%2C%20monospace%3B%0A%20%20line%2Dheight%3A%2010px%3B%0A%20%20color%3A%20%23555%3B%0A%20%20vertical%2Dalign%3A%20middle%3B%0A%20%20background%2Dcolor%3A%20%23fcfcfc%3B%0A%20%20border%3A%20solid%201px%20%23ccc%3B%0A%20%20border%2Dbottom%2Dcolor%3A%20%23bbb%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20box%2Dshadow%3A%20inset%200%20%2D1px%200%20%23bbb%3B%0A%7D%0A%0A%2Etask%2Dlist%2Ditem%20%7B%0A%20%20list%2Dstyle%2Dtype%3A%20none%3B%0A%7D%0A%0A%2Etask%2Dlist%2Ditem%2B%2Etask%2Dlist%2Ditem%20%7B%0A%20%20margin%2Dtop%3A%203px%3B%0A%7D%0A%0A%2Etask%2Dlist%2Ditem%20input%20%7B%0A%20%20margin%3A%200%200%2E35em%200%2E25em%20%2D1%2E6em%3B%0A%20%20vertical%2Dalign%3A%20middle%3B%0A%7D%0A%0A%3Achecked%2B%2Eradio%2Dlabel%20%7B%0A%20%20z%2Dindex%3A%201%3B%0A%20%20position%3A%20relative%3B%0A%20%20border%2Dcolor%3A%20%234078c0%3B%0A%7D%0A%0A%0Acode%20%3E%20%2Ekw%20%7B%20color%3A%20%23000000%3B%20%7D%0Acode%20%3E%20%2Edt%20%7B%20color%3A%20%23ed6a43%3B%20%7D%0Acode%20%3E%20%2Edv%20%7B%20color%3A%20%23009999%3B%20%7D%0Acode%20%3E%20%2Ebn%20%7B%20color%3A%20%23009999%3B%20%7D%0Acode%20%3E%20%2Efl%20%7B%20color%3A%20%23009999%3B%20%7D%0Acode%20%3E%20%2Ech%20%7B%20color%3A%20%23009999%3B%20%7D%0Acode%20%3E%20%2Est%20%7B%20color%3A%20%23183691%3B%20%7D%0Acode%20%3E%20%2Eco%20%7B%20color%3A%20%23969896%3B%20%7D%0Acode%20%3E%20%2Eot%20%7B%20color%3A%20%230086b3%3B%20%7D%0Acode%20%3E%20%2Eal%20%7B%20color%3A%20%23a61717%3B%20%7D%0Acode%20%3E%20%2Efu%20%7B%20color%3A%20%2363a35c%3B%20%20%7D%0Acode%20%3E%20%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%0Acode%20%3E%20%2Ewa%20%7B%20color%3A%20%23000000%3B%20%7D%0Acode%20%3E%20%2Ecn%20%7B%20color%3A%20%23008080%3B%20%20%7D%0Acode%20%3E%20%2Esc%20%7B%20color%3A%20%23008080%3B%20%7D%0Acode%20%3E%20%2Evs%20%7B%20color%3A%20%23183691%3B%20%7D%0Acode%20%3E%20%2Ess%20%7B%20color%3A%20%23183691%3B%20%7D%0Acode%20%3E%20%2Eim%20%7B%20color%3A%20%23000000%3B%20%7D%0Acode%20%3E%20%2Eva%20%7Bcolor%3A%20%23008080%3B%20%7D%0Acode%20%3E%20%2Ecf%20%7B%20color%3A%20%23000000%3B%20%20%7D%0Acode%20%3E%20%2Eop%20%7B%20color%3A%20%23000000%3B%20%7D%0Acode%20%3E%20%2Ebu%20%7B%20color%3A%20%23000000%3B%20%7D%0Acode%20%3E%20%2Eex%20%7B%20color%3A%20%23000000%3B%20%7D%0Acode%20%3E%20%2Epp%20%7B%20color%3A%20%23999999%3B%20%7D%0Acode%20%3E%20%2Eat%20%7B%20color%3A%20%23008080%3B%20%7D%0Acode%20%3E%20%2Edo%20%7B%20color%3A%20%23969896%3B%20%7D%0Acode%20%3E%20%2Ean%20%7B%20color%3A%20%23008080%3B%20%7D%0Acode%20%3E%20%2Ecv%20%7B%20color%3A%20%23008080%3B%20%7D%0Acode%20%3E%20%2Ein%20%7B%20color%3A%20%23008080%3B%20%7D%0A" rel="stylesheet">
<style>
body {
  box-sizing: border-box;
  min-width: 200px;
  max-width: 980px;
  margin: 0 auto;
  padding: 45px;
  padding-top: 0px;
}
</style>

</head>

<body>

<p><em>Supporting Information to</em><br /><strong>Accounting for genetic differences among unknown parents in microevolutionary studies: How to include genetic groups in quantitative genetic animal models</strong><br />================<br />Matthew E. Wolak &amp; Jane M. Reid</p>
<ul>
<li><p>Appendix S6: Construction and implementation of Q and A*</p>
<ul>
<li>6.1 A small example pedigree</li>
<li>6.2 Constructing Q</li>
<li><p>6.3 Constructing A*</p>
<ul>
<li>6.3.1 Genetic groups on top or bottom of A*?</li>
<li>6.3.2 Removing singularities and other problems within A*</li>
</ul></li>
<li><p>6.4 How to fit genetic groups in MCMCglmm, ASReml-R, ASReml-standalone, &amp; WOMBAT</p>
<ul>
<li>6.4.1 Tutorial dataset <code>ggTutorial</code></li>
<li><p>6.4.2 <code>MCMCglmm</code></p>
<ul>
<li>6.4.2.1 Preparing a pedigree with genetic groups</li>
<li>6.4.2.2 Fixed explicit genetic group effects with Q (from <code>nadiv</code>)</li>
<li>6.4.2.3 Random implicit genetic group effects with A* (from <code>nadiv</code>)</li>
</ul></li>
<li><p>6.4.3 <code>ASReml</code> in <code>R</code></p>
<ul>
<li>6.4.3.1 Preparing a pedigree with genetic groups</li>
<li>6.4.3.2 Fixed explicit genetic group effects with Q (from <code>nadiv</code>)</li>
<li>6.4.3.3 Fixed implicit genetic group effects with A* (from <code>nadiv</code> or <code>asreml</code>)</li>
<li>6.4.3.4 Random implicit genetic group effects with A* (from <code>nadiv</code>)</li>
</ul></li>
<li><p>6.4.4 ASReml Standalone</p>
<ul>
<li>6.4.4.1 Preparing a pedigree with genetic groups</li>
<li>6.4.4.2 Fixed explicit genetic group effects with Q (from <code>nadiv</code>)</li>
<li>6.4.4.3 Fixed implicit genetic group effects with A* (from <code>nadiv</code>)</li>
<li>6.4.4.4 Fixed implicit genetic group effects with A* (from ASReml)</li>
<li>6.4.4.5 Random implicit genetic group effects with A* (from ASReml)</li>
</ul></li>
<li><p>6.4.5 WOMBAT</p>
<ul>
<li>6.4.5.1 Preparing a pedigree with genetic groups</li>
<li>6.4.5.2 Fixed explicit genetic group effects with Q (from <code>nadiv</code>)</li>
<li>6.4.5.3 Random implicit genetic group effects with A* (from <code>nadiv</code>)</li>
<li>6.4.5.4 WOMBAT's genetic groups (Random group effects with Q from <code>nadiv</code>)</li>
</ul></li>
</ul></li>
<li>References: Appendix S6</li>
</ul></li>
<li><p>Software version information</p></li>
</ul>
<h1 id="appendix-s6-construction-and-implementation-of-q-and-a">Appendix S6: Construction and implementation of Q and A*</h1>
<p>Fitting animal models with genetic groups first necessitates formulating the appropriate <strong>Q</strong> and/or <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> matrices. First, we generally describe how <strong>Q</strong> and <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> are formed, with an emphasis on the code used to do this in the <code>R</code> package <code>nadiv</code> (&gt;v2.14.0; Wolak 2012). This is followed by explanations of minor changes that can be made to <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> to improve animal model convergence and how to deal with warnings from software regarding singularities and non-positive definite matrices. Next are sections with code that illustrate fitting genetic group animal models in the <code>MCMCglmm</code> and <code>asreml</code> packages in <code>R</code>, the <strong>ASReml</strong> standalone program, and finally the <strong>WOMBAT</strong> standalone program. In each of these four sections, code and examples are provided to fit genetic groups using the <code>nadiv</code> package in <code>R</code> to create the <strong>Q</strong> and <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> matrices that can then be supplied to these animal model fitting programs (in some cases outside of the <code>R</code> environment), followed by examples using existing functionality within each software program (see Table S6.1 for a summary of these programs and their capabilities).</p>
<p>The tutorials for these software programs all use the simulated dataset (<code>ggTutorial</code> available in <code>nadiv</code> or to download in <strong>WOMBAT</strong> and <strong>ASReml</strong> standalone formats) depicted in Figs 2 and 4 of the main text and described below. In <em>Appendix S4</em>, the <code>R</code> code in the <code>nadiv</code> function <code>simGG()</code> that is used to simulate the <code>ggTutorial</code> dataset is explained. Details of package and software program versions are available at the end of the supporting information.</p>
<p><strong>Table S6.1.</strong> Overview of animal model software highlighted in the tutorials. The genetic group capabilities row contains a description of the functionality that is available solely within each software program. The <strong>Form Q</strong> and <strong>Form</strong> <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> rows indicate if each program can create the <strong>Q</strong> or <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> matrices, respectively, from a supplied pedigree. We indicate whether fitting genetic groups explicitly (as fixed effects) or implicitly within the random effects structure (as either fixed or random effects) is recommended (+) or not (-) when using each software program.</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left"><strong><code>MCMCglmm</code></strong></th>
<th align="left"><strong><code>ASReml</code></strong> in <strong><code>R</code></strong></th>
<th align="left"><strong>ASReml</strong></th>
<th align="left"><strong>WOMBAT</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>Genetic group capabilities</strong></td>
<td align="left">None in <code>MCMCglmm</code>, but can use <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> or <strong>Q</strong> created with <code>nadiv</code></td>
<td align="left">The <code>asreml.Ainverse()</code> function creates <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span></td>
<td align="left"><code>!GROUPS</code> qualifier to the pedigree creates <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> and see the <code>!LAST</code> and <code>!GOFFSET</code> qualifiers (details below)</td>
<td align="left">Random genetic group effects (with separate variance component from the additive genetic variance) by including <code>GENGROUPS</code> in a <code>SPECIAL</code> block with a supplied <strong>Q</strong> (created with <code>nadiv</code>)</td>
</tr>
<tr class="even">
<td align="left"><strong>Form Q</strong></td>
<td align="left">No</td>
<td align="left">No</td>
<td align="left">No</td>
<td align="left">No</td>
</tr>
<tr class="odd">
<td align="left"><strong>Form</strong> <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span></td>
<td align="left">No</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
<td align="left">No</td>
</tr>
<tr class="even">
<td align="left"><strong>Explicit approach</strong></td>
<td align="left">+</td>
<td align="left">+</td>
<td align="left">+</td>
<td align="left">+</td>
</tr>
<tr class="odd">
<td align="left"><strong>Implicit approach</strong></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">    <em>Fixed</em></td>
<td align="left">-</td>
<td align="left">+</td>
<td align="left">+</td>
<td align="left">-</td>
</tr>
<tr class="odd">
<td align="left">    <em>Random</em></td>
<td align="left">+</td>
<td align="left">+</td>
<td align="left">+</td>
<td align="left">+</td>
</tr>
<tr class="even">
<td align="left"><strong>Free to use</strong></td>
<td align="left">Yes</td>
<td align="left">No</td>
<td align="left">No</td>
<td align="left">Yes</td>
</tr>
<tr class="odd">
<td align="left"><strong>Reference</strong></td>
<td align="left">Hadfield 2010</td>
<td align="left">Butler et al. 2009</td>
<td align="left">Gilmour et al. 2014</td>
<td align="left">Meyer 2007</td>
</tr>
</tbody>
</table>
<!---------     ------------    -----------   ------------->
<h2 id="a-small-example-pedigree">6.1 A small example pedigree</h2>
<p>Below we demonstrate how the matrices <strong>Q</strong> and <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> are constructed using an example pedigree from Quaas (1988). A detailed version of the Quaas pedigree is available in the <code>nadiv</code> package in <code>R</code> as the <code>Q1988</code> dataset:</p>
<p><br></p>
<table>
<thead>
<tr class="header">
<th align="left">id</th>
<th align="left">dam</th>
<th align="left">sire</th>
<th align="left">damGG</th>
<th align="left">sireGG</th>
<th align="left">phantomDam</th>
<th align="left">phantomSire</th>
<th align="left">group</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">g1</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">g2</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">a</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">g1</td>
<td align="left">g1</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">g1</td>
</tr>
<tr class="even">
<td align="left">b</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">g2</td>
<td align="left">g2</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">g2</td>
</tr>
<tr class="odd">
<td align="left">c</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">g2</td>
<td align="left">g2</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">g2</td>
</tr>
<tr class="even">
<td align="left">d</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">g1</td>
<td align="left">g1</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">g1</td>
</tr>
<tr class="odd">
<td align="left">e</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">g2</td>
<td align="left">g2</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">g2</td>
</tr>
<tr class="even">
<td align="left">A</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">g1</td>
<td align="left">g2</td>
<td align="left">a</td>
<td align="left">b</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">B</td>
<td align="left">A</td>
<td align="left">NA</td>
<td align="left">A</td>
<td align="left">g2</td>
<td align="left">A</td>
<td align="left">c</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">C</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">g1</td>
<td align="left">g2</td>
<td align="left">d</td>
<td align="left">e</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">D</td>
<td align="left">B</td>
<td align="left">C</td>
<td align="left">B</td>
<td align="left">C</td>
<td align="left">B</td>
<td align="left">C</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>The table above is essentially just a pedigree (first three columns indicate an individual's unique identifying code, dam, and sire). However, two rows have been added at the top of the pedigree for the unique genetic groups and extra columns are included for ease of using all possible pedigree formats accepted by the <code>nadiv</code> functions that implement genetic group methods.</p>
<p>In the dataset, &quot;g1&quot; and &quot;g2&quot; are two genetic groups, lower case letters are phantom parent identities, and upper case letters are observed individual identities. The genetic groups and phantom parents are assigned as in Quaas (1988). Additional details regarding the <code>Q1988</code> dataset in <code>nadiv</code> are in the <code>R</code> help file that can be viewed by running the command <code>?Q1988</code> in an <code>R</code> session.</p>
<p>Below, we will only deal with observed individuals in this dataset, such that the subset of <code>Q1988</code> we will use is:</p>
<p><br></p>
<pre class="sourceCode r"><code class="sourceCode r">Q1988sub &lt;-<span class="st"> </span>Q1988[-<span class="kw">c</span>(<span class="dv">3</span>:<span class="dv">7</span>), <span class="kw">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;damGG&quot;</span>, <span class="st">&quot;sireGG&quot;</span>)]</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">id</th>
<th align="left">damGG</th>
<th align="left">sireGG</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">g1</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">g2</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">A</td>
<td align="left">g1</td>
<td align="left">g2</td>
</tr>
<tr class="even">
<td align="left">B</td>
<td align="left">A</td>
<td align="left">g2</td>
</tr>
<tr class="odd">
<td align="left">C</td>
<td align="left">g1</td>
<td align="left">g2</td>
</tr>
<tr class="even">
<td align="left">D</td>
<td align="left">B</td>
<td align="left">C</td>
</tr>
</tbody>
</table>
<p>Note, this is not the only format for including genetic group information in functions of the <code>nadiv</code> package. To see a full description of alternative formats see the function help files, particularly for the <code>ggcontrib</code> (to make <strong>Q</strong>) and <code>makeAinv</code> (to make <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>) functions.</p>
<!---------     ------------    -----------   ------------->
<h2 id="constructing-q">6.2 Constructing Q</h2>
<p>As described in the main text, the matrix <strong>Q</strong> contains the fractional contributions from each of <em>r</em> genetic groups to each individual's genome, calcluated from the pedigree (see also Robinson 1986; Mrode 2005, ch. 2). Therefore, if there are <em>n</em> individuals in the pedigree (e.g., <em>n</em>=4 in <code>Q1988sub</code>), <strong>Q</strong> will be an <em>n</em> row by <em>r</em> column matrix. In Henderson's (1976) decomposition of the numerator relationship matrix (<strong>A</strong>=<strong>TDT'</strong>), the lower triangle matrix <strong>T</strong> reflects the contribution of each individual in the pedigree to every other individual. In other words, <strong>T</strong> traces the flow of genes from one generation to another. Therefore, if we add the <em>r</em> genetic groups to the top of the pedigree (originally of length <em>n</em>) as identities with unknown dam and sire (NA) and fill in genetic group labels as dam and sire identities of every individual with a missing parent (such as how <code>Q1988sub</code> is arranged) we can obtain the <strong>T</strong> matrix for a pedigree of length <em>n</em>+<em>r</em>. The first <em>r</em> columns of the <strong>T</strong> matrix contain the fractional contributions from each genetic group. Therefore, <strong>Q</strong> for the <em>n</em> individuals in a pedigree is the <em>r</em>+1 to <em>r</em>+<em>n</em> rows and the first <em>r</em> columns of <strong>T</strong>.</p>
<p>The <code>nadiv</code> function <code>ggcontrib()</code> constructs <strong>Q</strong> for a given pedigree with <em>r</em> potential genetic group contributions to each of the <em>n</em> individuals in the pedigree. For example, <strong>Q</strong> for <code>Q1988sub</code> is obtained:</p>
<pre class="sourceCode r"><code class="sourceCode r">(Q &lt;-<span class="st"> </span><span class="kw">ggcontrib</span>(Q1988sub))</code></pre>
<pre><code>##      g1    g2
## A 0.500 0.500
## B 0.250 0.750
## C 0.500 0.500
## D 0.375 0.625</code></pre>
<p>Each row in <strong>Q</strong> (each entry is a proportional contribution) sums to one and offspring inherit half of each genetic group contribution from each of their parents. Individuals <code>A</code> and <code>C</code> in <code>Q1988sub</code> each have a phantom dam from genetic group &quot;g1&quot; and phantom sire from genetic group &quot;g2&quot;. These individuals correspond to the first and third rows of <strong>Q</strong> above. As expected, the two genetic groups (each column in <strong>Q</strong>) contribute equally to the genomes of <code>A</code> and <code>C</code>.</p>
<p>Individual <code>B</code> has observed dam <code>A</code> and a phantom sire from genetic group &quot;g2&quot;. Row two of <strong>Q</strong> above is a sum of each parents' row (genetic group contributions) divided by two: dam <code>A</code> <code>[0.500 0.500]/2</code> plus phantom sire &quot;g2&quot; <code>[0.000 1.000]/2</code>. In other words, individual <code>B</code> gets half of dam <code>A</code>'s &quot;g1&quot; group contribution (<code>0.500/2</code>) and its phantom sire from &quot;g2&quot; does not contribute to the proportion of <code>B</code>'s genome derived from &quot;g1&quot;. Similarly, individual <code>B</code> gets half of dam <code>A</code>'s &quot;g2&quot; group contribution (<code>0.500/2</code>) plus half of the phantom sire &quot;g2&quot; contribution (<code>1.000/2</code>).</p>
<p>Finally, individual <code>D</code> has observed dam <code>B</code> and observed sire <code>C</code>. Therefore, row four of <strong>Q</strong> above is the sum of each parents' row (genetic group contributions) divided by two: dam <code>B</code> <code>[0.250 0.750]/2</code> plus sire <code>C</code> <code>[0.500 0.500]/2</code>.</p>
<p>Implementing an animal model with genetic group effects fitted explicitly as separate fixed regressions requires the <strong>Q</strong> matrix. Because every row of <strong>Q</strong> sums to one, it is not possible to solve an animal model to obtain estimates for every genetic group effect and an overall model intercept. Thus, genetic group effects are not estimable themselves, but can only be estimated when expressed as deviations (or functions) from other group effects (Lynch &amp; Walsh 1998, p.839-841). Therefore, a column/genetic group is chosen as the &quot;reference group&quot; and is assigned a genetic group effect of 0 (see practical implementation of this below). All other group effects will represent deviations from this reference group. For example, we might choose genetic group &quot;g1&quot; in the <code>Q1988sub</code> pedigree as our reference group. The estimate of the fixed regression slope from the second column of <strong>Q</strong> equals the &quot;g2&quot; genetic group mean expressed as a deviation from the reference group (&quot;g1&quot;) mean of zero. If we had used a pedigree with more than two genetic groups, still setting the first group as the reference, then the genetic group estimates for each group are all deviations from the &quot;g1&quot; reference group mean of zero.</p>
<p><strong>Q</strong> is also needed to calculate breeding values (<strong>a</strong>) from an animal model that has fitted fixed genetic group effects implicitly within the random effects syntax of the model software. This is because such a model will yield predictions of total additive genetic effects (<strong>u</strong>). From equation (6) in the main text, an individual's breeding value (<span class="math"><em>a</em><sub><em>i</em></sub></span>) equals the total additive genetic effect (<span class="math"><em>u</em><sub><em>i</em></sub></span>) minus a weighted sum of genetic group effects contributing to that individual. The weighted sum of genetic group contributions for all individuals can be calculated as the matrix product <strong>Qg</strong>, where <strong>g</strong> is a vector of all genetic group effects and <strong>Q</strong> is calculated above.</p>
<!---------     ------------    -----------   ------------->
<h2 id="constructing-a">6.3 Constructing A*</h2>
<p>A major advance leading to the widespread use of animal models comes from Henderson (1976) and subsequent researchers' (e.g., Quaas 1976, 1995; Meuwissen and Luo 1992) work to directly construct the matrix inverse of the additive genetic relatedness matrix (<span class="math"><strong>A</strong><sup> <strong>−</strong> <strong>1</strong></sup></span>). Direct methods for obtaining <span class="math"><strong>A</strong><sup> <strong>−</strong> <strong>1</strong></sup></span> are necessary, because <span class="math"><strong>A</strong><sup> <strong>−</strong> <strong>1</strong></sup></span> and not <strong>A</strong> is used when solving the equations in the animal model. <span class="math"><strong>A</strong><sup> <strong>−</strong> <strong>1</strong></sup></span> has a unique structure that can be formed by tracing the flow of alleles from each individual to its offspring. Thus methods to directly construct <span class="math"><strong>A</strong><sup> <strong>−</strong> <strong>1</strong></sup></span> rely on the basic premise that the flow of alleles through a pedigree can be traced because each individual inherits, on average, half of its alleles from each parent with some sampling variation that can be modeled based on the Mendelian sampling variance in the population.</p>
<p>To estimate genetic group effects by implicitly fitting the genetic groups within the random effect syntax of the model software, requires an inverse matrix to model the covariance among individual total additive genetic values and group effects based on alleles shared identical by descent. Conveniently, the matrix inverse accounting for individual-individual, group-group, group-individual, and individual-group sharing of alleles can be constructed directly from the pedigree in a very similar manner to <span class="math"><strong>A</strong><sup> <strong>−</strong> <strong>1</strong></sup></span> (see also <em>Appendix S5</em>; Westell, Quaas &amp; Van Vleck 1988; Quaas 1988). This matrix, <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> (following notation of Quaas 1988), is a compilation of four sub-matrices that are each a mathematical function of <strong>Q</strong>, <span class="math"><strong>A</strong><sup> <strong>−</strong> <strong>1</strong></sup></span>, or both (Fig. 3e in main text).</p>
<p>The <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> for any pedigree with genetic groups can be obtained using the <code>makeAinv()</code> function in the <code>nadiv</code> package. For example, <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> for the <code>Q1988sub</code> pedigree is:</p>
<pre class="sourceCode r"><code class="sourceCode r">AstarOut &lt;-<span class="st"> </span><span class="kw">makeAinv</span>(Q1988sub, <span class="dt">ggroups =</span> <span class="dv">2</span>)
(Astar &lt;-<span class="st"> </span>AstarOut$Ainv)</code></pre>
<pre><code>## 6 x 6 sparse Matrix of class &quot;dgCMatrix&quot;
##                                                 
## A   1.3333333 -0.6666667  .    . -0.5 -0.1666667
## B  -0.6666667  1.8333333  0.5 -1  .   -0.6666667
## C   .          0.5000000  1.5 -1 -0.5 -0.5000000
## D   .         -1.0000000 -1.0  2  .    .        
## g1 -0.5000000  .         -0.5  .  0.5  0.5000000
## g2 -0.1666667 -0.6666667 -0.5  .  0.5  0.8333333</code></pre>
<p>There are several points to highlight regarding <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>. First, this matrix can be split into four blocks: (1) the upper-left 4-by-4 (<em>n</em>x<em>n</em>) block (individual-individual covariance structure), (2) the lower-left 2-by-4 (<em>r</em>x<em>n</em>) block (group-individual covariance structure), (3) the upper-right 4-by-2 (<em>n</em>x<em>r</em>) block (individual-group covariance structure), and (4) the lower-right 2-by-2 (<em>r</em>x<em>r</em>) block (group-group covariance structure). Note, the upper-left block of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> is the same as the <span class="math"><strong>A</strong><sup> <strong>−</strong> <strong>1</strong></sup></span> for the <code>Q1988</code> pedigree without implicitly including genetic group effects (see also Fig. 3e in main text). For example, <span class="math"><strong>A</strong><sup> <strong>−</strong> <strong>1</strong></sup></span> for the Q1988 pedigree without genetic groups can be obtained and compared to <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> above using the same <code>nadiv</code> function without invoking the genetic group algorithm [<code>makeAinv(..., ggroups = NULL, ...)</code>, the default value of the <code>ggroups</code> argument]:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">makeAinv</span>(Q1988[-<span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">7</span>), <span class="kw">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;dam&quot;</span>, <span class="st">&quot;sire&quot;</span>)])$Ainv</code></pre>
<pre><code>## 4 x 4 sparse Matrix of class &quot;dgCMatrix&quot;
##                                
## A  1.3333333 -0.6666667  .    .
## B -0.6666667  1.8333333  0.5 -1
## C  .          0.5000000  1.5 -1
## D  .         -1.0000000 -1.0  2</code></pre>
<p><span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> constructed in <code>nadiv</code> can be used in various animal model software programs (Table S6.1) to implicitly include genetic group effects within the random effects structure of the model. Although the details vary among software programs (see tutorials in the subsections to <em>Appendix S6.4</em> for detailed instructions in each of the highlighted software programs), the general approach is to associate the inverse covariance matrix <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> with the term in the model representing additive genetic effects; almost exactly the same way as the typical <span class="math"><strong>A</strong><sup> <strong>−</strong> <strong>1</strong></sup></span> is associated with additive genetic effects in a basic animal model. However, some potential alterations to <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> should be considered before and during the model fitting process.</p>
<!---------     ------------    -----------   ------------->
<h3 id="genetic-groups-on-top-or-bottom-of-a">6.3.1 Genetic groups on top or bottom of A*?</h3>
<p>The entries in <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> corresponding to genetic groups can be placed in the last <em>r</em> rows and columns (as above) or the first <em>r</em> rows and columns. When setting up <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>, switching between these placements is trivial. The consequences for using <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>, however, can be rather large. Solving an animal model requires solving a large set of equations (the Mixed Model Equations or MME). Often, some of these equations may not be unique or in other words two equations may be exactly the same, very similar, or have a linear dependency (such that knowing the solution to one equation means the solution to the other equation is also known). This is a cause of singularities in the MME coefficient matrix of an animal model.</p>
<p>The MME are solved by either moving from the first set of equations to the last set ('top-down') or from the last set to the first set ('bottom-up'). In either case, if two equations are nearly the same then the model will obtain a solution for the first of the pair, but then encounter a problem with the second. Some software packages might automatically deal with this second, non-unique equation. For example, <strong>ASReml</strong> solves the equations from the bottom up and will delete the second equation (equation on top) to continue to solve the MME (Butler et al. 2009, pp. 134-135; Gilmour et al. 2014, pp. 106-107).</p>
<p>Unfortunately, the algorithms to solve the MME are not this simple in practice. Even though <strong>ASReml</strong> states which way the equations are solved, some options allow the program to re-order the equations to simplify solving the model. This re-ordering is based on the contents of each equation without respect to its categorization in the model. In other words, one genetic group equation might be re-ordered so that it is placed next to an equation for a year random effect level while another genetic group equation in the same model may be placed elsewhere with a random effect of individual additive genetic value. Although one cannot be completely certain where the genetic group equations will end up when the software program optimizes the order of equations to most efficiently solve the model, the ability to easily switch where in <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> the genetic groups are positioned has been a strategy that has sometimes worked well in our own personal experience. Switching the placement of the genetic groups from the top to the bottom (or vice versa) of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> has sometimes solved convergence issues.</p>
<p>However, the standalone version of <strong>ASReml</strong> has the <code>!LAST</code> job qualifier (see Table S6.1 and the <strong>ASReml</strong> tutorial in <em>Appendix S6.4.4</em>) to consistently re-order the MME such that the genetic groups equations are solved last. This option assumes that the genetic groups are the first <em>r</em> rows and columns of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>, where <em>r</em> is the number of levels following the <code>!LAST</code> qualifier, and therefore 'on top'. We are not aware of a similar argument that can be implemented for a model using <code>asreml</code> in <code>R</code>.</p>
<p><strong>WOMBAT</strong>, also, has several MME ordering strategies that can be implemented. However, these re-order the entire set of equations and the order of certain levels of random effects cannot be specified (Meyer 2007, section 5.3.1). <code>MCMCglmm</code> re-orders the MME according to algorithms associated with the underlying <code>CSparse</code> functions (Davis 2006; Hadfield 2010) and also cannot designate certain levels of random effects to a certain location in the re-ordered equations. Therefore, it is not clear how specifying genetic groups at the top or bottom of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> will affect the convergence of any particular model.</p>
<p>The <code>nadiv</code> function <code>makeAinv()</code>, enables the user to place genetic groups at the top or bottom of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>, in an attempt to solve genetic group equations first or last. Therefore, if any singularities in the MME coefficient matrix occur then the user can attempt to re-order the genetic group equations in the hope that this will lead to model convergence. The <code>gOnTop</code> argument to the <code>makeAinv()</code> function switches between placing the genetic groups on top or on bottom of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>, with the default to place genetic groups at the bottom of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> [<code>makeAinv(..., gOnTop = FALSE, ...)</code>].</p>
<!---------     ------------    -----------   ------------->
<h3 id="removing-singularities-and-other-problems-within-a">6.3.2 Removing singularities and other problems within A*</h3>
<p>Fitting genetic group effects implicitly often causes singularities in the coefficient matrix of the MME, that can sometimes be overcome by slight changes to the strategy for grouping (Schaeffer 1991). Software programs may report this issue as a non-positive definite generalized inverse matrix (often abbreviated GIV, GIN, or ginverse), or alternatively stating that a GIV/GIN/ginverse is negative definite, non-positive semi-definite, or ill-conditioned. For example, <strong>ASReml</strong> often deals with these types of singularities according to its own strategies (Butler et al. 2009; Gilmour et al. 2014). If genetic groups are specified in an <strong>ASReml</strong> analysis and a singularity occurs the program will introduce a row to the matrix to overcome this (see <em>Lagrangian multipliers</em> in Gilmour et al. 2014, pp. 164-165). Regardless of which software program is used, however, adding values to some of the matrix elements may also remove singularities occurring within the MME in addition to the aforementioned strategy of ordering <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> with genetic groups either on top or at the bottom.</p>
<p>Adding a small number to some diagonals can remove singularities (Schaeffer 1994, 1999; Oikawa and Yasuda 2009; Gilmour 2010). Schaeffer (1994, 1999) advocates adding an identity matrix to the <em>r</em>x<em>r</em> group-group block of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> such that all of the diagonals (<span class="math"><em>d</em><sub><em>i</em><em>i</em></sub></span>) become <span class="math">1 + <em>d</em><sub><em>i</em><em>i</em></sub></span>. This addition to <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> means that the genetic group effects are no longer, conceptually speaking, fixed effects but are random effects with expectations of zero and a variance describing their distribution (see <em>Appendices S1 &amp; S5</em>). Further, predicted genetic group effects will be biased toward the expected value of zero when genetic groups are random effects, just like any other random effects, with the amount of bias depending on how much information the data provide to predict genetic group effects (Hadfield et al. 2010). This bias will extend to any functions involving the predicted genetic group effects, specifically the predicted total additive genetic effects (<strong>u</strong>). Although, in many cases the mixed model equations and subsequent variance component estimates change only slightly, thus basic interpretations of results will remain the same (but see cautionary note below; further discussion in Schaeffer 1994). The strategy of adding an identity matrix is desirable if there are many individuals assigned to each group, because it does not re-rank the predicted breeding values and can improve convergence (Schaeffer 1994). The main change to the model when the leading diagonal elements of the group-group portion of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> are altered is a (co)variance matrix for traits within groups is added to the model equations dealing with the genetic group effects. In the simple case of a single trait, this variance is assumed to be the same across group effects with no covariances between groups (i.e., groups effects are normally distributed with a variance of <span class="math"><strong>I</strong><strong>σ</strong><sub><strong>g</strong></sub><sup><strong>2</strong></sup></span>). In practice this variance is often assumed to equal the additive genetic variance for the individual total additive genetic effects (Sullivan 1999, see also <strong>WOMBAT</strong>'s genetic groups in <em>Appendix S6.4.5.4</em>).</p>
<p>A further interpretation of this assumption means that a model's estimate of additive genetic variance will also include the magnitudes of the genetic group effects. This may cause problems if the variance in the genetic group effects themselves is much greater than the true additive genetic variance. In such a case, adding a smaller value than 1 to the diagonals (<span class="math"><em>d</em><sub><em>i</em><em>i</em></sub></span>) of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> structures the model to reflect this difference. Using values other than 1 for the addition to the diagonal elements effectively means that the ratio of the variance among genetic group effects to the additive genetic variance is no longer constrained to be 1:1. Thus, when modelling genetic groups as random effects we strongly caution users to carefully consider the sensitivity of the additive genetic variance estimate to the choice of value added to the group-group diagonal elements of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>. Multiple models fitted with different values added to the diagonal elements are recommended to ensure an unbiased estimate of the additive genetic variance. Schaeffer (1994) provides a detailed discussion and interpretation of different strategies for altering <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>.</p>
<p>Note that <strong>WOMBAT</strong> fits a separate variance component to the genetic group effects (see <em>Appendix S6.4.5.4</em>), thus offering a direct way to check that the variance in genetic group effects can be assumed to be the same as the additive genetic variance. <strong>ASReml</strong> provides the <code>!GOFFSET</code> pedigree file qualifier to add a value to the group-group diagonal elements when using <strong>ASReml</strong>'s <code>!GROUPS</code> pedigree qualifier (see <em>Appendix S6.4.4.4</em>). Otherwise, this alteration of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> is easily accomplished manually after creating <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> with the <code>makeAinv()</code> function in the <code>nadiv</code> package. Altering the <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> for the <code>Q1988sub</code> pedigree above (with genetic groups on the bottom) would proceed as follows and result in the matrix displayed below:</p>
<pre class="sourceCode r"><code class="sourceCode r">n &lt;-<span class="st"> </span><span class="dv">4</span>
r &lt;-<span class="st"> </span><span class="dv">2</span>
(ggIdentity &lt;-<span class="st"> </span><span class="kw">bdiag</span>(<span class="kw">Diagonal</span>(<span class="dt">n =</span> n, <span class="dt">x =</span> <span class="dv">0</span>), <span class="kw">Diagonal</span>(<span class="dt">n =</span> r, <span class="dt">x =</span> <span class="dv">1</span>)))</code></pre>
<pre><code>## 6 x 6 sparse Matrix of class &quot;dtCMatrix&quot;
##                 
## [1,] 0 . . . . .
## [2,] . 0 . . . .
## [3,] . . 0 . . .
## [4,] . . . 0 . .
## [5,] . . . . 1 .
## [6,] . . . . . 1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">(AstarI &lt;-<span class="st"> </span>Astar +<span class="st"> </span>ggIdentity)</code></pre>
<pre><code>## 6 x 6 sparse Matrix of class &quot;dgCMatrix&quot;
##                                                 
## A   1.3333333 -0.6666667  .    . -0.5 -0.1666667
## B  -0.6666667  1.8333333  0.5 -1  .   -0.6666667
## C   .          0.5000000  1.5 -1 -0.5 -0.5000000
## D   .         -1.0000000 -1.0  2  .    .        
## g1 -0.5000000  .         -0.5  .  1.5  0.5000000
## g2 -0.1666667 -0.6666667 -0.5  .  0.5  1.8333333</code></pre>
<p>Caution is necessary, however, when dealing with singularities in an animal model. Specifically, model comparison may not be possible if singularities occur. <strong>ASReml</strong> alters the order of equations to remove singularities. Consequently, different terms can cause singularities between runs of the model, where the model may have been slightly modified for the purposes of testing the significance of variance components or computing profile likelihoods of variance components. Singularities caused by different terms will affect the log-likelihood of the model and therefore procedures using likelihood ratio test statistics may no longer be valid (Gilmour 2005; Butler et al. 2009; Gilmour et al. 2014)</p>
<!------------------------------------------------------------->
<!---------     ------------    -----------   ------------->
<h2 id="how-to-fit-genetic-groups-in-mcmcglmm-asreml-r-asreml-standalone-wombat">6.4 How to fit genetic groups in MCMCglmm, ASReml-R, ASReml-standalone, &amp; WOMBAT</h2>
<!---------     ------------    -----------   ------------->
<h3 id="tutorial-dataset-ggtutorial">6.4.1 Tutorial dataset <code>ggTutorial</code></h3>
<p>We provide a step-by-step demonstration of how to fit genetic groups in animal models, by modelling genetic group effects either explicitly as separate fixed regressions or implicitly within the random effects, using the different animal model software programs. All demonstrations use the dataset <code>ggTutorial</code>, which is available in the <code>nadiv</code> package for working in <code>R</code>, as supplementary file <code>ggTutorial.dat</code> for working in the standalone <strong>ASReml</strong> program, and as supplementary file <code>ggTutorial.d</code> for working in the <strong>WOMBAT</strong> program. This dataset was simulated using the <code>nadiv</code> package (details in <em>Appendix S4</em>) and are the same data as those depicted in Figs 2 and 4 from the main text. The dataset contains 6000 individuals across 15 generations. The simulation specifies a carrying capacity of 400 individuals per generation, 200 mating pairs per generation, and 40 immigrants per generation. The expected difference between founder and immigrant mean breeding values equals <code>3</code> and both the environmental and additive genetic variances for both the founder and immigrant groups equal <code>1</code>. The data are loaded into <code>R</code> by loading the <code>nadiv</code> package.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(nadiv)</code></pre>
<p>The first three columns of <code>ggTutorial</code> contain the complete pedigree and all 6000 individuals have a phenotypic record in <code>p</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(ggTutorial)</code></pre>
<pre><code>##   id dam sire parAvgU mendel          u           r        p is gen
## 1  1  NA   NA      NA     NA -0.3928101 -0.08355464 19.52364  0   1
## 2  2  NA   NA      NA     NA -0.6750007  0.14201698 19.46702  0   1
## 3  3  NA   NA      NA     NA -0.4416978  1.89195823 21.45026  0   1
## 4  4  NA   NA      NA     NA -1.0299707 -1.29820650 17.67182  0   1
## 5  5  NA   NA      NA     NA -1.9126222  0.46681834 18.55420  0   1
## 6  6  NA   NA      NA     NA -0.9089290 -0.82577884 18.26529  0   1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(ggTutorial)</code></pre>
<pre><code>## 'data.frame':    6000 obs. of  10 variables:
##  $ id     : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ dam    : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ sire   : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ parAvgU: num  NA NA NA NA NA NA NA NA NA NA ...
##  $ mendel : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ u      : num  -0.393 -0.675 -0.442 -1.03 -1.913 ...
##  $ r      : num  -0.0836 0.142 1.892 -1.2982 0.4668 ...
##  $ p      : num  19.5 19.5 21.5 17.7 18.6 ...
##  $ is     : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ gen    : int  1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<p>The rest of the columns contain:</p>
<ul>
<li><p><code>parAvgU</code> is the average <em>u</em> (total additive genetic effect) of each individual's parents</p></li>
<li><p><code>mendel</code> is the Mendelian sampling deviation from the mid-parent value that is unique to each individual</p></li>
<li><p><code>u</code> is the total additive genetic effect of each individual's genotype</p></li>
<li><p><code>r</code> is the residual deviation of each individual</p></li>
<li><p><code>p</code> is the phenotype for each individual (population expected mean is 20)</p></li>
<li><p><code>is</code> indicates the immigration status, where focal population residents have <code>is == 0</code> and immigrants have <code>is == 1</code></p></li>
<li><p><code>gen</code> is the generation in which each individual was born</p></li>
</ul>
<p>The supplementary files for use in <strong>ASReml</strong> and <strong>WOMBAT</strong> contain a subset of these variables plus three derived variables. The <strong>ASReml</strong> and <strong>WOMBAT</strong> data files contain continuous variables for the coefficient of inbreeding (<em>f</em>) and two genetic group genomic contributions (from <strong>Q</strong>). For demonstration purposes, these are added to the basic <code>ggTutorial</code> below within each section. Note the <strong>WOMBAT</strong> pedigree and data files have had 10000 added to the individual identity codes to comply with <strong>WOMBAT</strong> data structure requirements.</p>
<p>It is necessary to fit a fixed regression on the coefficient of inbreeding (<em>f</em>) to account for inbreeding depression and minimize bias in estimates of quantitative genetic parameters (Kennedy, Schaeffer &amp; Sorensen 1988; Reid &amp; Keller 2010; Wolak &amp; Keller 2014). This is not directly part of the process to fit genetic groups in the animal model, but it is considered necessary when fitting animal models to population data in which inbreeding occurs.</p>
<hr />
<!------------------------------------------------------------->
<!---------     ------------    -----------   ------------->
<h3 id="mcmcglmm">6.4.2 <code>MCMCglmm</code></h3>
<p>Modelling genetic groups either explicitly as separate fixed regressions or implicitly within the random effects syntax of <code>MCMCglmm</code> requires either <strong>Q</strong> or <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> to be created using the <code>nadiv</code> package. Below we demonstrate how to create these matrices and fit each in a <code>MCMCglmm</code> model.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(MCMCglmm)
<span class="kw">library</span>(nadiv)</code></pre>
<p>To complete the basic preparations of the data for an animal model, all that is necessary is to calculate the coefficients of inbreeding (<em>f</em>; to minimize bias from inbreeding depression, see the last paragraph of <em>Appendix 6.4.1</em> above). This calculation can be done using the <code>inverseA()</code> function of <code>MCMCglmm</code>. Consequently, the <span class="math"><strong>A</strong><sup> <strong>−</strong> <strong>1</strong></sup></span> matrix is also created, which we will assign as its own object in <code>R</code>, because it will be needed in the model fitting genetic group effects explicitly as fixed covariate regressions with <strong>Q</strong> (see <em>Appendix 6.4.2.2</em>).</p>
<pre class="sourceCode r"><code class="sourceCode r">ainvOut &lt;-<span class="st"> </span><span class="kw">inverseA</span>(ggTutorial[, <span class="dv">1</span>:<span class="dv">3</span>])
Ainv &lt;-<span class="st"> </span>ainvOut$Ainv
ggTutorial$f &lt;-<span class="st"> </span>ainvOut$inbreeding</code></pre>
<p><code>MCMCglmm</code> facilitates modelling of non-Gaussian response variables, which has greatly extended the application of animal models in evolutionary ecology to a range of non-Gaussian phenotypes. Fitting genetic groups is no different when modelling non-Gaussian response variables. In such models, the genetic group effects (fitted either explicitly as separate fixed regressions or implicitly within the random effects) are estimated on the underlying latent scale.</p>
<h4 id="preparing-a-pedigree-with-genetic-groups">6.4.2.1 Preparing a pedigree with genetic groups</h4>
<p>Here, we provide general instructions to prepare pedigrees. Calculating the matrix of genetic group contributions (<strong>Q</strong>) and the augmented inverse relatedness matrix (<span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>) requires a pedigree that indicates groups instead of missing values for parents. In the <code>ggTutorial</code> data, we will assign all individuals with unknown parents in the first generation phantom parents from one genetic group (<code>foc0</code>). All individuals in subsequent generations that have unknown parents will be assigned phantom parents from a second genetic group (<code>g1</code>). Alternatively, this second group could be further divided into genetic groups based on generation. However, the data were simulated such that every immigrant has the same expected mean breeding value, regardless of the generation in which the immigrant was born. Therefore, we will stick to a total of two genetic groups (but, feel free to model more groups!).</p>
<p>First, create an object that will be the pedigree with genetic groups (<code>ggPed</code>).</p>
<pre class="sourceCode r"><code class="sourceCode r">ggPed &lt;-<span class="st"> </span>ggTutorial[, <span class="kw">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;dam&quot;</span>, <span class="st">&quot;sire&quot;</span>, <span class="st">&quot;is&quot;</span>, <span class="st">&quot;gen&quot;</span>)]
naPar &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">is.na</span>(ggPed[, <span class="dv">2</span>]))
ggPed$GG &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;NA&quot;</span>, <span class="kw">nrow</span>(ggPed))
  <span class="co"># 'focal' genetic group = &quot;foc0&quot; and 'immigrant' = &quot;g1&quot;</span>
  <span class="co"># obtained by pasting &quot;foc&quot; &amp; &quot;g&quot; with immigrant status &quot;0&quot; or &quot;1&quot;, respectively</span>
  ggPed$GG[naPar] &lt;-<span class="st"> </span><span class="kw">as.character</span>(ggPed$is[naPar])
  ggPed$GG[ggPed$GG ==<span class="st"> &quot;0&quot;</span>] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;foc&quot;</span>, ggPed$GG[ggPed$GG ==<span class="st"> &quot;0&quot;</span>])
  ggPed$GG[ggPed$GG ==<span class="st"> &quot;1&quot;</span>] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;g&quot;</span>, ggPed$GG[ggPed$GG ==<span class="st"> &quot;1&quot;</span>])
ggPed[naPar, <span class="dv">2</span>:<span class="dv">3</span>] &lt;-<span class="st"> </span>ggPed[naPar, <span class="st">&quot;GG&quot;</span>]</code></pre>
<p>Note, the approach and format of the pedigree above is different from the <code>Q1988sub</code> pedigree earlier - mostly because the format here makes it easier to specify genetic groups in a pedigree for this particular case, but partly to illustrate the flexibility of <code>nadiv</code> functions. To be more specific, the <code>Q1988sub</code> pedigree contained two extra rows for the two genetic groups. The <code>ggroups</code> argument to <code>makeAinv()</code> supplied an integer indicating how many rows at the begining of the pedigree contained genetic groups and not individuals. However, in the <code>ggPed</code> above no extra rows are added to the pedigree, but in the next few sections the character vector given to the <code>ggroups</code> argument in both <code>ggcontrib()</code> and <code>makeAinv()</code> specifies the name of the unique genetic groups that have been filled in for individuals instead of missing dam and sire identities.</p>
<!---------     ------------    -----------   ------------->
<h4 id="fixed-explicit-genetic-group-effects-with-q-from-nadiv">6.4.2.2 Fixed explicit genetic group effects with Q (from <code>nadiv</code>)</h4>
<p>Fitting genetic group effects explicitly requires the columns of <strong>Q</strong> to be included as separate fixed covariate regressions. The code below creates <strong>Q</strong> for the <code>ggPed</code> pedigree and adds the columns (<code>foc0</code> and <code>g1</code>) as variables in <code>ggTutorial</code> so that they can be included in a model.</p>
<pre class="sourceCode r"><code class="sourceCode r">Q &lt;-<span class="st"> </span><span class="kw">ggcontrib</span>(ggPed[, <span class="dv">1</span>:<span class="dv">3</span>], <span class="dt">ggroups =</span> <span class="kw">c</span>(<span class="st">&quot;foc0&quot;</span>, <span class="st">&quot;g1&quot;</span>))
ggTutorial &lt;-<span class="st"> </span><span class="kw">cbind</span>(ggTutorial, Q)
<span class="kw">str</span>(ggTutorial)</code></pre>
<pre><code>## 'data.frame':    6000 obs. of  13 variables:
##  $ id     : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ dam    : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ sire   : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ parAvgU: num  NA NA NA NA NA NA NA NA NA NA ...
##  $ mendel : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ u      : num  -0.393 -0.675 -0.442 -1.03 -1.913 ...
##  $ r      : num  -0.0836 0.142 1.892 -1.2982 0.4668 ...
##  $ p      : num  19.5 19.5 21.5 17.7 18.6 ...
##  $ is     : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ gen    : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ f      : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ foc0   : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ g1     : num  0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<p>An important point to make is that, because the pedigree and data for <code>ggTutorial</code> are in the same dataframe, the genetic group coefficients from <strong>Q</strong> can be added directly to the data with <code>ggTutorial &lt;- cbind(ggTutorial, Q)</code> above. However, whenever a pedigree contains more individuals than the data (or in a different order), an intermediate step is required. Specifically, since the <strong>Q</strong> matrix contains a row for every individual in the pedigree, only the subset of rows in <strong>Q</strong> that correspond to phenotyped individuals in a dataset should be extracted and ordered according to the identities in the data.</p>
<p>The fixed regressions on <code>foc0</code> and <code>g1</code> can be combined with the standard <span class="math"><strong>A</strong><sup> <strong>−</strong> <strong>1</strong></sup></span> to specify an animal model in <code>MCMCglmm</code>. Below, we write out the specification of the <code>MCMCglmm</code> default priors for the fixed effects in the model. We recommend a normal prior distribution for each genetic group fixed regression coefficient with a mean of 0 and a very large variance. Our fixed effect prior specification below has an element in <code>mu</code> and <code>V</code> of <code>prPE$B</code> to correspond with the model's: intercept, regression on the coefficient of inbreeding (<em>f</em>), and regressions on the genetic group contributions (<code>foc0</code> and <code>g1</code>). Because unique solutions to the model do not exist (see discussion of estimability in <em>Appendix S6.2</em>) for the intercept, coefficient of inbreeding (<em>f</em>), and genetic group effects (<code>foc0</code> and <code>g1</code>), we fit the <code>foc0</code> genetic group as the last fixed effect. This ensures that the model sets <code>foc0</code> as a reference group and estimates the <code>g0</code> genetic group effect as a deviation from the mean breeding value in the <code>foc0</code> group. The model is written out below, and a saved version is available on Dryad (Wolak &amp; Reid 2016) as supporting information file &quot;./MCMCglmm/ggRegMC.RData&quot; so that it is not necessary to re-run this model to examine the results.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Use diffuse normal priors (MCMCglmm defaults) for all fixed effects</span>
<span class="co"># Parameter expanded prior on additive genetic variance</span>
## Scaled F-dsitribution with numerator and denominator df=1
prPEexp &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">B =</span> <span class="kw">list</span>(<span class="dt">mu =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">3</span>), <span class="dt">V =</span> <span class="kw">diag</span>(<span class="dv">3</span>)*<span class="fl">1e10</span>), 
         <span class="dt">R =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="dv">1</span>, <span class="dt">nu =</span> <span class="fl">0.002</span>),
         <span class="dt">G =</span> <span class="kw">list</span>(<span class="dt">G1 =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="dv">1</span>, <span class="dt">nu =</span> <span class="dv">1</span>, <span class="dt">alpha.mu =</span> <span class="dv">0</span>, <span class="dt">alpha.V =</span> <span class="dv">1000</span>)))

<span class="co"># NOTE: the saved model could be loaded instead of running it below</span>
## load(file = &quot;./MCMCglmm/ggRegMC.RData&quot;) 
ggRegMC &lt;-<span class="st"> </span><span class="kw">MCMCglmm</span>(<span class="dt">fixed =</span> p ~<span class="st"> </span>f +<span class="st"> </span>g1 +<span class="st"> </span>foc0,
    <span class="dt">random =</span> ~<span class="st"> </span>id,
    <span class="dt">ginverse =</span> <span class="kw">list</span>(<span class="dt">id =</span> Ainv),
    <span class="dt">data =</span> ggTutorial,
    <span class="dt">prior =</span> prPEexp,
    <span class="dt">singular.ok =</span> <span class="ot">FALSE</span>,
    <span class="dt">pr =</span> <span class="ot">TRUE</span>,
    <span class="dt">nitt =</span> <span class="dv">28000</span>, <span class="dt">burn =</span> <span class="dv">3000</span>, <span class="dt">thin =</span> <span class="dv">25</span>)</code></pre>
<p>The posterior distributions of genetic group effects are included in the <code>Sol</code> object along with the posterior distributions of the other fixed effects. Note the software has dropped the <code>foc0</code> group estimate in this model, implying this is the reference group and the <code>g1</code> genetic group effects is the estimated deviation from the reference. To report the posterior modes and 95% limits of the highest posterior density:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">with</span>(ggRegMC, <span class="kw">cbind</span>(<span class="dt">postMode =</span> <span class="kw">posterior.mode</span>(Sol[, <span class="dv">1</span>:<span class="dv">3</span>]),
    <span class="kw">HPDinterval</span>(Sol[, <span class="dv">1</span>:<span class="dv">3</span>])))</code></pre>
<pre><code>##               postMode     lower     upper
## (Intercept) 19.7952878 19.664293 19.931933
## f            0.3756279 -2.652013  4.529125
## g1           3.1375194  2.941707  3.285130</code></pre>
<p>The above posterior mode estimate of 3.138 agrees with the expected difference of <code>3</code> between the mean breeding values of the immigrant group (<code>3</code>) and the founder population (<code>0</code>), specified in the simulation.</p>
<p>The posterior distribution of the breeding values (<strong>a</strong>) can be accessed from <code>ggRegMC$Sol[, -c(1:3)]</code>. Because the order of rows in <strong>Q</strong> matches the order of individual identities in <code>ggTutorial</code>, the posterior distribution for the total additive genetic effects (<strong>u</strong>) can be calculated as (eqn 5 in main text):</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Add 0 genetic group effect for the reference group 'foc0' to the 'g1' samples</span>
regPost_gHat &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="dv">0</span>, ggRegMC$Sol[, <span class="st">&quot;g1&quot;</span>])
<span class="co"># For the ith mcmc iteration that was saved, calculate 'u'</span>
regPost_u &lt;-<span class="st"> </span><span class="kw">as.mcmc</span>(<span class="kw">t</span>(<span class="kw">sapply</span>(<span class="kw">seq</span>(<span class="kw">nrow</span>(ggRegMC$Sol)),
    <span class="dt">FUN =</span> function(i){Q %*%<span class="st"> </span>regPost_gHat[, i] +<span class="st"> </span>ggRegMC$Sol[i, -<span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">3</span>)]})))</code></pre>
<!---------     ------------    -----------   ------------->
<h4 id="random-implicit-genetic-group-effects-with-a-from-nadiv">6.4.2.3 Random implicit genetic group effects with A* (from <code>nadiv</code>)</h4>
<p>Fitting genetic group effects implicitly within the random effects portion of the <code>MCMCglmm</code> model specification requires the augmented inverse <strong>A</strong> matrix (<span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>) to be supplied as a sparse matrix in the <code>ginverse</code> argument. The code below creates <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> for the <code>ggPed</code> pedigree using the <code>makeAinv</code> function in the <code>nadiv</code> package.</p>
<pre class="sourceCode r"><code class="sourceCode r">Astar &lt;-<span class="st"> </span><span class="kw">makeAinv</span>(ggPed[, <span class="dv">1</span>:<span class="dv">3</span>], <span class="dt">ggroups =</span> <span class="kw">c</span>(<span class="st">&quot;foc0&quot;</span>, <span class="st">&quot;g1&quot;</span>), <span class="dt">gOnTop =</span> <span class="ot">TRUE</span>)$Ainv</code></pre>
<p>In the above code, we directed <code>makeAinv()</code> to include the genetic groups on top (top-left block) of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> using the <code>gOnTop = TRUE</code> argument. At this point we could try fitting the model with this version of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> (i.e., <code>Astar</code>). However, the model returns an error that <code>G-structure 1 is ill-conditioned</code>. In other words, <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> has at least one eigenvalue that is either negative or zero. Re-defining the groupings can eliminate such a singularity. However, removing the singularity in the matrix while maintaining the current groupings is accomplished by adding a small value to the diagonal elements of the group-group portion of the matrix. Note that such an addition changes the interpretation of the effects in the model, as discussed above (<em>Appendix 6.3.2</em> as well as <em>Appendix S5</em>), now implying that the genetic group effects are random effects in the model. Below, we add 0.1 to the diagonal element of the <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> which will constrain the variance in genetic group effects to be one tenth the additive genetic variance estimated by the model. A value of 0.1 may bias estimates of additive genetic variance in models of other datasets. Therefore, we advise testing values other than 0.1 (e.g., 1 or 10) and comparing estimates from these alternative models. Note that a value of 1 constrains the variance in genetic group effects to be equal to the additive genetic variance estimated by the model.</p>
<pre class="sourceCode r"><code class="sourceCode r">AstarAdd &lt;-<span class="st"> </span>Astar
(ggrows &lt;-<span class="st"> </span><span class="kw">match</span>(<span class="kw">c</span>(<span class="st">&quot;foc0&quot;</span>, <span class="st">&quot;g1&quot;</span>), <span class="kw">dimnames</span>(AstarAdd)[[<span class="dv">1</span>]]))</code></pre>
<pre><code>## [1] 1 2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">diag</span>(AstarAdd)[ggrows] &lt;-<span class="st"> </span><span class="kw">diag</span>(AstarAdd)[ggrows] +<span class="st"> </span><span class="fl">0.1</span>
Astar[<span class="dv">1</span>:<span class="dv">3</span>, <span class="dv">1</span>:<span class="dv">3</span>]</code></pre>
<pre><code>## 3 x 3 sparse Matrix of class &quot;dgCMatrix&quot;
##                
## foc0 400   . -1
## g1     . 520  .
## 1     -1   .  1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">AstarAdd[<span class="dv">1</span>:<span class="dv">3</span>, <span class="dv">1</span>:<span class="dv">3</span>]</code></pre>
<pre><code>## 3 x 3 sparse Matrix of class &quot;dgCMatrix&quot;
##                    
## foc0 400.1   .   -1
## g1     .   520.1  .
## 1     -1.0   .    1</code></pre>
<p>The <code>AstarAdd</code> sparse inverse matrix can now be associated with the individual identities (<code>id</code>) by supplying it as an argument to <code>ginverse</code> in the <code>MCMCglmm</code> model. We specify the same default prior distribution for the fixed effects below (i.e., the same ones as we wrote out in <em>Appendix 6.4.2.2</em>). The prior distribution for the <code>id</code> term in the model is the prior used for the additive genetic variance and, in this case, also the same prior for the variance of the genetic group effects. It is unclear how the prior specified for the additive genetic variance will affect the estimate of the genetic group effects or even what prior is to be used in this context. As usual with Bayesian analyses, we recommend priors that are framed within the context of the data at hand, the model being fitted, and any <em>a priori</em> belief in the model parameters. Further we suggest testing the sensitivity of any particular prior used for a given model and especially when genetic group effects are treated as random effects by the model.</p>
<p>The model is written out below, but a saved version is available on Dryad (Wolak &amp; Reid 2016) as supporting information file &quot;./MCMCglmm/ggAstarRandMC.RData&quot; so that it is not necessary to re-run this model to examine the results.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Parameter expanded prior on additive genetic variance</span>
prPEimp &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">B =</span> <span class="kw">list</span>(<span class="dt">mu =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="dt">V =</span> <span class="kw">diag</span>(<span class="dv">2</span>)*<span class="fl">1e10</span>), 
         <span class="dt">R =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="dv">1</span>, <span class="dt">nu =</span> <span class="fl">0.002</span>),
         <span class="dt">G =</span> <span class="kw">list</span>(<span class="dt">G1 =</span> <span class="kw">list</span>(<span class="dt">V =</span> <span class="dv">1</span>, <span class="dt">nu =</span> <span class="dv">1</span>, <span class="dt">alpha.mu =</span> <span class="dv">0</span>, <span class="dt">alpha.V =</span> <span class="dv">1000</span>)))

<span class="co"># NOTE: the saved model could be loaded instead of running it below</span>
## load(file = &quot;./MCMCglmm/ggAstarRandMC.RData&quot;) 
ggAstarRandMC &lt;-<span class="st"> </span><span class="kw">MCMCglmm</span>(<span class="dt">fixed =</span> p ~<span class="st"> </span>f,
    <span class="dt">random =</span> ~<span class="st"> </span>id,
    <span class="dt">ginverse =</span> <span class="kw">list</span>(<span class="dt">id =</span> AstarAdd),
    <span class="dt">data =</span> ggTutorial,
    <span class="dt">prior =</span> prPEimp,
    <span class="dt">pr =</span> <span class="ot">TRUE</span>,
    <span class="dt">nitt =</span> <span class="dv">53000</span>, <span class="dt">burn =</span> <span class="dv">3000</span>, <span class="dt">thin =</span> <span class="dv">50</span>)</code></pre>
<p>Alternatively, the non-altered matrix <code>Astar</code> could be supplied to the <code>ginverse</code> argument of <code>MCMCglmm</code> to see the types of warnings that led us to fit the model with the matrix <code>AstarAdd</code>.</p>
<p>The posterior distributions of genetic group effects are included in the <code>Sol</code> object (as long as <code>pr = TRUE</code> in the model statement) along with the posterior distributions of the fixed effects. To report the posterior modes and 95% limits of the highest posterior density:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">with</span>(ggAstarRandMC, <span class="kw">cbind</span>(<span class="dt">postMode =</span> <span class="kw">posterior.mode</span>(Sol[, <span class="dv">1</span>:<span class="dv">4</span>]),
    <span class="kw">HPDinterval</span>(Sol[, <span class="dv">1</span>:<span class="dv">4</span>])))</code></pre>
<pre><code>##              postMode     lower     upper
## (Intercept) 22.023119 16.604035 25.597429
## f            1.348870 -2.842843  4.164732
## id.foc0     -2.164536 -5.801390  3.099577
## id.g1        0.786011 -2.742551  6.267101</code></pre>
<p>Note that all fixed effects in this model are estimable and the model returns these estimates along with predicting both of the genetic group effects. The genetic group predictions, themselves, are random effects and thus are deviations from their expected value of 0. The posterior mode of differences between genetic group predictions 3.107 (95% HPD interval:2.945, 3.277) agrees with the expected difference between the mean breeding values of the immigrant group (<code>3</code>) and the founder population (<code>0</code>) that was specified in the simulation.</p>
<p>The posterior distribution of the total additive genetic effects (<strong>u</strong>) can be accessed from <code>ggAstarRandMC$Sol[, -c(1:4)]</code>. Because the order of rows in <strong>Q</strong> matches the order of individual identities in <code>ggTutorial</code>, the posterior distribution for the breeding values (<strong>a</strong>) can be calculated as (eqn 6 in main text):</p>
<pre class="sourceCode r"><code class="sourceCode r">AstarPost_gHat &lt;-<span class="st"> </span>ggAstarRandMC$Sol[, <span class="dv">3</span>:<span class="dv">4</span>]
<span class="co"># For the ith mcmc iteration that was saved, calculate 'a'</span>
<span class="co"># Assuming Q has already been calculated as above</span>
AstarPost_a &lt;-<span class="st"> </span><span class="kw">as.mcmc</span>(<span class="kw">t</span>(<span class="kw">sapply</span>(<span class="kw">seq</span>(<span class="kw">nrow</span>(ggAstarRandMC$Sol)),
    <span class="dt">FUN =</span> function(i){ggAstarRandMC$Sol[i, -<span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">4</span>)] -
<span class="st">            </span>Q %*%<span class="st"> </span><span class="kw">matrix</span>(AstarPost_gHat[i, ], <span class="dt">ncol =</span> <span class="dv">1</span>)})))</code></pre>
<hr />
<!------------------------------------------------------------->
<!---------     ------------    -----------   ------------->
<h3 id="asreml-in-r">6.4.3 <code>ASReml</code> in <code>R</code></h3>
<p>To model genetic group effects explicitly as separate fixed regressions in an animal model using the <code>R</code> package <code>asreml</code> requires <strong>Q</strong> to be created using the <code>nadiv</code> package and then included in the <code>asreml()</code> model function. Including genetic group effects implicitly within the random effects of an animal model in <code>asreml()</code> can be done either using <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> constructed with <code>nadiv</code> or with <code>asreml::asreml.Ainverse()</code>. All three of these approaches will be demonstrated below using the simulated dataset <code>ggTutorial</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(asreml)
<span class="kw">library</span>(nadiv)</code></pre>
<p>To complete the basic preparations of the data for an animal model, all that is necessary is to calculate the coefficients of inbreeding (<em>f</em>; to minimize bias from inbreeding depression, see the last paragraph of <em>Appendix 6.4.1</em>). This calculation can be done using the <code>asreml.Ainverse()</code> function of <code>asreml</code>. Consequently, the <span class="math"><strong>A</strong><sup> <strong>−</strong> <strong>1</strong></sup></span> matrix is also created, which we will assign as its own <code>R</code> object, because it will be needed in the model fitting genetic group effects explicitly as separate fixed covariate regressions with <strong>Q</strong> below (<em>Appendix 6.4.3.2</em>).</p>
<pre class="sourceCode r"><code class="sourceCode r">ainvOut &lt;-<span class="st"> </span><span class="kw">asreml.Ainverse</span>(ggTutorial[, <span class="dv">1</span>:<span class="dv">3</span>])
listAinv &lt;-<span class="st"> </span>ainvOut$ginv
ggTutorial$f &lt;-<span class="st"> </span>ainvOut$inbreeding
## Have to also convert the 'id' variable to a factor for models below
ggTutorial$id &lt;-<span class="st"> </span><span class="kw">as.factor</span>(ggTutorial$id)</code></pre>
<h4 id="preparing-a-pedigree-with-genetic-groups-1">6.4.3.1 Preparing a pedigree with genetic groups</h4>
<p>Calculating the matrix of genetic group contributions (<strong>Q</strong>) and the augmented inverse relatedness matrix (<span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>) requires a pedigree that has genetic groups indicated instead of missing values for parents. In the <code>ggTutorial</code> data, we will assign all individuals with unknown parents in the first generation phantom parents from one genetic group (<code>foc0</code>). All individuals in subsequent generations that have unknown parents will be assigned phantom parents from a second genetic group (<code>g1</code>). Alternatively, this second group could be further divided into genetic groups based on generation. However, the data were simulated such that every immigrant has the same expected mean breeding value, regardless of the generation in which it was born. Therefore, we will stick to a total of two genetic groups (but, feel free to model more groups!).</p>
<p>First, create an object that will be the pedigree with genetic groups (<code>ggPed</code>).</p>
<pre class="sourceCode r"><code class="sourceCode r">ggPed &lt;-<span class="st"> </span>ggTutorial[, <span class="kw">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;dam&quot;</span>, <span class="st">&quot;sire&quot;</span>, <span class="st">&quot;is&quot;</span>, <span class="st">&quot;gen&quot;</span>)]
naPar &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">is.na</span>(ggPed[, <span class="dv">2</span>]))
ggPed$GG &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;NA&quot;</span>, <span class="kw">nrow</span>(ggPed))
  <span class="co"># 'focal' genetic group = &quot;foc0&quot; and 'immigrant' = &quot;g1&quot;</span>
  <span class="co"># obtained by pasting &quot;foc&quot; &amp; &quot;g&quot; with immigrant status &quot;0&quot; or &quot;1&quot;, respectively</span>
  ggPed$GG[naPar] &lt;-<span class="st"> </span><span class="kw">as.character</span>(ggPed$is[naPar])
  ggPed$GG[ggPed$GG ==<span class="st"> &quot;0&quot;</span>] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;foc&quot;</span>, ggPed$GG[ggPed$GG ==<span class="st"> &quot;0&quot;</span>])
  ggPed$GG[ggPed$GG ==<span class="st"> &quot;1&quot;</span>] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;g&quot;</span>, ggPed$GG[ggPed$GG ==<span class="st"> &quot;1&quot;</span>])
ggPed[naPar, <span class="dv">2</span>:<span class="dv">3</span>] &lt;-<span class="st"> </span>ggPed[naPar, <span class="st">&quot;GG&quot;</span>]
<span class="co"># Two rows need to be added for the genetic groups</span>
## Genetic groups will be given the missing value NA instead of parent identities
ggPed &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">id =</span> <span class="kw">c</span>(<span class="st">&quot;foc0&quot;</span>, <span class="st">&quot;g1&quot;</span>, <span class="kw">as.character</span>(ggPed$id)),
        <span class="dt">dam =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">NA</span>, <span class="kw">as.character</span>(ggPed$dam)),
        <span class="dt">sire =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">NA</span>, <span class="kw">as.character</span>(ggPed$sire)))
<span class="kw">head</span>(ggPed)</code></pre>
<pre><code>##     id  dam sire
## 1 foc0 &lt;NA&gt; &lt;NA&gt;
## 2   g1 &lt;NA&gt; &lt;NA&gt;
## 3    1 foc0 foc0
## 4    2 foc0 foc0
## 5    3 foc0 foc0
## 6    4 foc0 foc0</code></pre>
<p>Note that the <code>nadiv</code> function <code>makeAinv()</code> used to construct <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> is more flexible than <code>asreml</code>'s <code>asreml.Ainverse()</code> in the way pedigrees containing genetic groups can be formatted (for more detail on <code>makeAinv()</code> formats, see the help file by running the command <code>?makeAinv</code> in an <code>R</code> session - particularly the examples at the end of the file - or the genetic group pedigree used above in the <code>MCMCglmm</code> tutorial). To be more specific, the format required by <code>asreml.Ainverse()</code> is similar to the <code>Q1988sub</code> pedigree used earlier in the tutorial (<em>Appendix 6.1</em>) which contains two extra rows for the two genetic groups.</p>
<h4 id="fixed-explicit-genetic-group-effects-with-q-from-nadiv-1">6.4.3.2 Fixed explicit genetic group effects with Q (from <code>nadiv</code>)</h4>
<p>Fitting genetic group effects explicitly in <code>asreml</code> requires the columns of <strong>Q</strong> to be included as separate fixed covariate regressions. The code below creates <strong>Q</strong> for the <code>ggPed</code> pedigree and adds the columns (<code>foc0</code> and <code>g1</code>) as variables in <code>ggTutorial</code> so that they can be included in a model.</p>
<pre class="sourceCode r"><code class="sourceCode r">Q &lt;-<span class="st"> </span><span class="kw">ggcontrib</span>(ggPed)
ggTutorial &lt;-<span class="st"> </span><span class="kw">cbind</span>(ggTutorial, Q)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(ggTutorial)</code></pre>
<pre><code>## 'data.frame':    6000 obs. of  13 variables:
##  $ id     : Factor w/ 6000 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ dam    : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ sire   : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ parAvgU: num  NA NA NA NA NA NA NA NA NA NA ...
##  $ mendel : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ u      : num  -0.393 -0.675 -0.442 -1.03 -1.913 ...
##  $ r      : num  -0.0836 0.142 1.892 -1.2982 0.4668 ...
##  $ p      : num  19.5 19.5 21.5 17.7 18.6 ...
##  $ is     : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ gen    : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ f      : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ foc0   : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ g1     : num  0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<p>An important point to make is that, because the pedigree and data for <code>ggTutorial</code> have essentially the same sizes and structures (only <code>ggPed</code> now has two extra rows for the genetic groups - but these will be dropped automatically from <strong>Q</strong> by <code>ggcontrib()</code>), the genetic group coefficients from <strong>Q</strong> can be added directly to the data with <code>ggTutorial &lt;- cbind(ggTutorial, Q)</code> above. However, whenever a pedigree contains more individuals than the data (or in a different order), an intermediate step is required. Specifically, since the <strong>Q</strong> matrix contains a row for every individual in the pedigree, only the subset of rows in <strong>Q</strong> that correspond to phenotyped individuals in a dataset should be extracted and ordered according to the identities in the data.</p>
<p>The fixed regressions on <code>foc0</code> and <code>g1</code> can be combined with the standard <span class="math"><strong>A</strong><sup> <strong>−</strong> <strong>1</strong></sup></span> to specify an animal model in <code>asreml()</code>. Because unique solutions to the model do not exist (see discussion of estimability in <em>Appendix S6.2</em>) for the intercept, coefficient of inbreeding (<em>f</em>), and genetic group effects (<code>foc0</code> and <code>g1</code>), we fit the <code>foc0</code> genetic group as the last fixed effect. This ensures that the model sets <code>foc0</code> as a reference group and estimates the <code>g0</code> genetic group effect as a deviation from the mean breeding value in the <code>foc0</code> group.</p>
<pre class="sourceCode r"><code class="sourceCode r">ggRegASR &lt;-<span class="st"> </span><span class="kw">asreml</span>(<span class="dt">fixed =</span> p ~<span class="st"> </span>f +<span class="st"> </span>g1 +<span class="st"> </span>foc0,
    <span class="dt">random =</span> ~<span class="st"> </span><span class="kw">ped</span>(id),
    <span class="dt">ginverse =</span> <span class="kw">list</span>(<span class="dt">id =</span> listAinv),
    <span class="dt">data =</span> ggTutorial)</code></pre>
<p>The estimates of the genetic group effects are included with the fixed effect estimates. Note the software has set the <code>foc0</code> group estimate to zero in this model, implying this is the reference group and the <code>g1</code> genetic group effect is the estimated deviation. The variance of the estimated genetic group effect (<code>g1</code>) is included with the variances of the fixed effect estimates, which are reported on <code>asreml</code>'s underlying transformed scale. To re-scale the variances of the fixed effects back to the phenotypic scale and report them as standard errors:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">with</span>(ggRegASR, <span class="kw">cbind</span>(<span class="dt">Effect =</span> coefficients$fixed,
    <span class="dt">seEffect =</span> <span class="kw">sqrt</span>(vcoeff$fixed *<span class="st"> </span>sigma2)))</code></pre>
<pre><code>##                 Effect   seEffect
## foc0         0.0000000 0.00000000
## g1           3.1167796 0.08929429
## f            0.6660162 1.83248941
## (Intercept) 19.7976160 0.06579030</code></pre>
<p>The above estimate of 3.117 agrees with the expected difference between mean breeding value in the immigrant group (<code>3</code>) and the founder population (<code>0</code>) that was specified in the simulation.</p>
<p>The predicted breeding values (<strong>a</strong>) can be accessed from <code>ggRegASR$coefficients$random</code>. Because the order of rows in <strong>Q</strong> matches the order of individual identities in <code>ggTutorial</code>, the total additive genetic effects (<strong>u</strong>) can be calculated without any further manipulation as (eqn 5 in main text):</p>
<pre class="sourceCode r"><code class="sourceCode r">reg_gHat &lt;-<span class="st"> </span><span class="kw">matrix</span>(ggRegASR$coefficients$fixed[<span class="dv">1</span>:<span class="dv">2</span>], <span class="dt">ncol =</span> <span class="dv">1</span>)
reg_u &lt;-<span class="st"> </span>Q %*%<span class="st"> </span>reg_gHat +<span class="st"> </span>ggRegASR$coefficients$random</code></pre>
<p>Note, if more individuals are in the pedigree than the dataset and/or the identities in the pedigree and data are ordered differently, more coding is necessary to ensure that the predicted genetic effect for a particular individual is added to the correct weighted genetic group contribution. Additionally, if more random effects are included in the model, care has to be taken in order to ensure the correct random effect predictions are extracted for the breeding values (<strong>a</strong>). The <code>R</code> function <code>match()</code> is particularly helpful in these cases.</p>
<h4 id="fixed-implicit-genetic-group-effects-with-a-from-nadiv-or-asreml">6.4.3.3 Fixed implicit genetic group effects with A* (from <code>nadiv</code> or <code>asreml</code>)</h4>
<p>Fitting fixed effects of genetic groups implicity within the random effects of an animal model requires the augmented inverse relatendess matrix (<span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>) to be supplied as a list in the <code>ginverse</code> argument. First, we create the sparse matrix of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> for the <code>ggPed</code> pedigree using the <code>makeAinv</code> function in the <code>nadiv</code> package and then demonstrate how to obtain this same matrix with the <code>asreml</code> package.</p>
<pre class="sourceCode r"><code class="sourceCode r">listAstar &lt;-<span class="st"> </span><span class="kw">makeAinv</span>(ggPed, <span class="dt">ggroups =</span> <span class="dv">2</span>, <span class="dt">gOnTop =</span> <span class="ot">FALSE</span>)$listAinv</code></pre>
<p>In the above code, we directed <code>makeAinv()</code> to include the genetic groups on bottom (bottom-right block) of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> using <code>gOnTop = FALSE</code>. This was done to improve model convergence (see <em>Appendix 6.3</em> and its subsections). In this case, the <code>asreml</code> model converges. In other pedigrees, models, and/or genetic group classifications, if singularities occur then sometimes this can be overcome by adding one (or a small value) to the diagonal elements of the group-group portion of the matrix (although see discussion of this in <em>Appendix S5</em> and cautions/considerations in <em>Appendix 6.3.2</em>). The alteration is demonstrated below along with cautions and interpretations (<em>Appendix 6.4.3.4</em>). Note, the easiest approach is to adjust the genetic group diagonals of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> using the matrix returned by <code>makeAinv()</code> (i.e., object <code>Ainv</code> in the list), then convert the matrix to the list format required by <code>asreml</code>.</p>
<p>Alternatively, we can use <code>asreml</code>'s function <code>asreml.Ainverse()</code> to obtain a list format of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>.</p>
<pre class="sourceCode r"><code class="sourceCode r">listAstar &lt;-<span class="st"> </span><span class="kw">asreml.Ainverse</span>(ggPed, <span class="dt">groups =</span> <span class="dv">2</span>)$ginv</code></pre>
<p>CAUTION: under the current and previous versions of <code>asreml</code> (current version at the end of Supporting Information), quite often <code>asreml.Ainverse()</code> simply does not work. It will return an object with a <code>ginv</code> entry that is a <code>data.frame</code>, but with zero rows. Sometimes, re-running the above command will work - otherwise use <code>nadiv</code>'s <code>makeAinv()</code> (<em>Appendix 6.4.3</em>)! Note that in the above code, <code>asreml.Ainverse()</code> includes the genetic groups on top (top-left block) of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>. Often models fitting this structure of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> have trouble converging due to this matrix not being positive-definite (see <em>Appendix 6.3</em> and its subsections). One strategy to remedy this is to place the genetic groups on the bottom of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>. Since there is no easy option to specify this in <code>asreml.Ainverse()</code> we recommend using <code>nadiv</code>'s function <code>makeAinv()</code> as demonstrated above.</p>
<p>Regardless of which package was used to create <code>listAstar</code>, this sparse inverse matrix in list format has two extra properties ('attributes') that are critical for being able to use it in an <code>asreml</code> model. First (and not specific to just genetic group models), all <code>asreml</code> ginverse objects must have the &quot;rowNames&quot; attribute to map row/column numbers back to the factor levels in the model variable. Second, specific to models fitting fixed genetic groups implicitly within the random effects the <code>listAstar</code> object must have the &quot;geneticGroups&quot; attribute where the first number indicates the number of unique genetic groups. This is essential for <code>asreml</code> to correctly calculate the residual degrees of freedom as part of the residual variance and log-likelihood calculations. These attributes are the last two rows of the internal object structure:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(listAstar)</code></pre>
<pre><code>## 'data.frame':    19642 obs. of  3 variables:
##  $ row   : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ column: num  1 2 3 4 5 6 7 8 9 10 ...
##  $ Ainv  : num  1 1.5 1 1 1.5 1 1 1 1 2 ...
##  - attr(*, &quot;rowNames&quot;)= chr  &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##  - attr(*, &quot;geneticGroups&quot;)= num  2 0</code></pre>
<p>Both of these attributes are discussed in the help file to <code>makeAinv()</code> and can be accessed by typing <code>?makeAinv</code> in <code>R</code>. Now the object <code>listAstar</code> can be associated with the individual identities (<code>id</code>) in the model by supplying the list to the <code>ginverse</code> argument in the <code>asreml()</code> function.</p>
<pre class="sourceCode r"><code class="sourceCode r">ggAstarASR &lt;-<span class="st"> </span><span class="kw">asreml</span>(<span class="dt">fixed =</span> p ~<span class="st"> </span>f,
    <span class="dt">random =</span> ~<span class="st"> </span><span class="kw">ped</span>(id),
    <span class="dt">ginverse =</span> <span class="kw">list</span>(<span class="dt">id =</span> listAstar),
    <span class="dt">data =</span> ggTutorial)</code></pre>
<p>The estimate of the genetic group effects are included with the random effect predictions. Since we directed <code>makeAinv()</code> to position the genetic groups on the bottom of <code>Astar</code>, the genetic group effects are the last two predicted values. The variance of the estimated genetic group effects are included with the variances of the random effect predictions, which are reported on <code>asreml</code>'s underlying transformed scale. To re-scale the variances of the fixed effects and genetic group effects back to the phenotypic scale and report these as standard errors along with the estimates themselves:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># find the location of the genetic groups</span>
(ggrows &lt;-<span class="st"> </span><span class="kw">match</span>(<span class="kw">c</span>(<span class="st">&quot;foc0&quot;</span>, <span class="st">&quot;g1&quot;</span>), <span class="kw">attr</span>(listAstar, <span class="st">&quot;rowNames&quot;</span>)))</code></pre>
<pre><code>## [1] 6001 6002</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># genetic group and fixed effects (with re-scaled standard errors)</span>
<span class="kw">with</span>(ggAstarASR, <span class="kw">cbind</span>(<span class="dt">Effect =</span> <span class="kw">c</span>(coefficients$fixed, coefficients$random[ggrows]),
    <span class="dt">seEffect =</span> <span class="kw">sqrt</span>(<span class="kw">c</span>(vcoeff$fixed, vcoeff$random[ggrows]) *<span class="st"> </span>sigma2)))</code></pre>
<pre><code>##                  Effect   seEffect
## f             0.6660162 1.83248941
## (Intercept)   0.0000000 0.00000000
## ped(id)_foc0 19.7976160 0.06579030
## ped(id)_g1   22.9143956 0.06008392</code></pre>
<p>Note the software has set the intercept estimate to zero in this model (see discussion of estimability in <em>Appendix S6.2</em>), implying this is the reference to which the <code>foc0</code> and <code>g1</code> genetic group effects are the estimated deviations. Therefore, the predicted total additive genetic effects (<strong>u</strong>) include the overall phenotypic mean. However, the difference between the genetic group effects 3.117 agrees with the expected difference between the mean breeding values of the immigrant group (<code>3</code>) and the founder population (<code>0</code>) that was specified in the simulation.</p>
<p>The predicted total additive genetic effects (<strong>u</strong>) can be accessed from <code>ggAstarASR$coefficients$random[-ggrows]</code>. Because the order of rows in <strong>Q</strong> matches the order of individual identities in <code>ggTutorial</code>, the breeding values (<strong>a</strong>) can be calculated without any further manipulation as (eqn 6 in main text):</p>
<pre class="sourceCode r"><code class="sourceCode r">Astar_gHat &lt;-<span class="st"> </span><span class="kw">matrix</span>(ggAstarASR$coefficients$random[ggrows], <span class="dt">ncol =</span> <span class="dv">1</span>)
Astar_a &lt;-<span class="st"> </span>ggAstarASR$coefficients$random[-ggrows] -<span class="st"> </span>Q %*%<span class="st"> </span>Astar_gHat</code></pre>
<p>Note, if more individuals are in the pedigree than the dataset and/or the identities in the pedigree and data are ordered differently, more coding is necessary to ensure that the predicted genetic effect for a particular individual is added to the correct weighted genetic group contribution. Additionally, if more random effects are included in the model, care has to be taken in order to ensure the correct random effect predictions are extracted for the total additive genetic effects (<strong>u</strong>) and used to calculate breeding values (<strong>a</strong>). The <code>R</code> function <code>match()</code> is particularly helpful in these cases.</p>
<h4 id="random-implicit-genetic-group-effects-with-a-from-nadiv-1">6.4.3.4 Random implicit genetic group effects with A* (from <code>nadiv</code>)</h4>
<p>Fitting random effects of genetic groups implicity within the random effects of an animal model requires the augmented inverse relatendess matrix (<span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>) to be supplied as a list in the <code>ginverse</code> argument. First, we create the sparse matrix of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> for the <code>ggPed</code> pedigree using the <code>makeAinv</code> function in the <code>nadiv</code> package, then make the necessary alterations (see discussion of this in <em>Appendix S5</em> and cautions/considerations in <em>Appendix 6.3.2</em>) so the model interprets the genetic groups as random effects, convert the sparse matrix to a list, and fit the model.</p>
<pre class="sourceCode r"><code class="sourceCode r">Astar &lt;-<span class="st"> </span><span class="kw">makeAinv</span>(ggPed, <span class="dt">ggroups =</span> <span class="dv">2</span>, <span class="dt">gOnTop =</span> <span class="ot">FALSE</span>)$Ainv</code></pre>
<p>In the above code, we directed <code>makeAinv()</code> to include the genetic groups on bottom (bottom-right block) of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> using <code>gOnTop = FALSE</code>. This was done to improve model convergence (see <em>Appendix 6.3</em> and its subsections).</p>
<p>Next we add a small value to the diagonal elements of the group-group portion of the matrix taking the same approach as in the <code>MCMCglmm</code> tutorial above (<em>Appendix 6.4.2.3</em>). As a result of this alteration, the genetic group effects are conceptually random effects in the model. Below, we add 0.1 to the diagonal element of the <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> which will constrain the variance in genetic group effects to be one tenth the additive genetic variance estimated by the model. A value of 0.1 may bias estimates of additive genetic variance in models of other datasets. Therefore, we advise testing values other than 0.1 (e.g., 1 or 10) and comparing estimates from these alternative models. Note that a value of 1 constrains the variance in genetic group effects to be equal to the additive genetic variance estimated by the model.</p>
<p>The easiest approach is to adjust the genetic group diagonals of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>, and this is why we stored the matrix returned by <code>makeAinv()</code> above (i.e., object <code>Ainv</code> in the list). Once the additions are made, we can then convert the matrix to the list format required by <code>asreml</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">AstarAdd &lt;-<span class="st"> </span>Astar
(ggrows &lt;-<span class="st"> </span><span class="kw">match</span>(<span class="kw">c</span>(<span class="st">&quot;foc0&quot;</span>, <span class="st">&quot;g1&quot;</span>), <span class="kw">dimnames</span>(AstarAdd)[[<span class="dv">1</span>]]))</code></pre>
<pre><code>## [1] 6001 6002</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">diag</span>(AstarAdd)[ggrows] &lt;-<span class="st"> </span><span class="kw">diag</span>(AstarAdd)[ggrows] +<span class="st"> </span><span class="fl">0.1</span>
Astar[ggrows, ggrows]</code></pre>
<pre><code>## 2 x 2 sparse Matrix of class &quot;dgCMatrix&quot;
##             
## foc0 400   .
## g1     . 520</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">AstarAdd[ggrows, ggrows]</code></pre>
<pre><code>## 2 x 2 sparse Matrix of class &quot;dgCMatrix&quot;
##                 
## foc0 400.1   .  
## g1     .   520.1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># convert to the list format using `nadiv::sm2list()`</span>
listAstarAdd &lt;-<span class="st"> </span><span class="kw">sm2list</span>(AstarAdd, <span class="dt">rownames =</span> <span class="kw">rownames</span>(AstarAdd))
<span class="co"># Should be NO &quot;geneticGroups&quot; attribute (or element 1 of this attribute must==0)</span>
<span class="kw">str</span>(listAstarAdd)</code></pre>
<pre><code>## 'data.frame':    19642 obs. of  3 variables:
##  $ row   : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ column: num  1 2 3 4 5 6 7 8 9 10 ...
##  $ A     : num  1 1.5 1 1 1.5 1 1 1 1 2 ...
##  - attr(*, &quot;rowNames&quot;)= chr  &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...</code></pre>
<p>The object <code>listAstarAdd</code> can be associated with the individual identities (<code>id</code>) in the model by supplying the list to the <code>ginverse</code> argument in the <code>asreml()</code> function.</p>
<pre class="sourceCode r"><code class="sourceCode r">ggAstarRanASR &lt;-<span class="st"> </span><span class="kw">asreml</span>(<span class="dt">fixed =</span> p ~<span class="st"> </span>f,
    <span class="dt">random =</span> ~<span class="st"> </span><span class="kw">ped</span>(id),
    <span class="dt">ginverse =</span> <span class="kw">list</span>(<span class="dt">id =</span> listAstarAdd),
    <span class="dt">data =</span> ggTutorial)</code></pre>
<p>The predictions of the genetic group effects are included with the random effect predictions. Since we directed <code>makeAinv()</code> to position the genetic groups on the bottom of <code>Astar</code>, the genetic group effects are the last two predicted values. The variance of the random effect predictions are reported on <code>asreml</code>'s underlying transformed scale. To re-scale the variances of the genetic group predictions back to the phenotypic scale and report these as standard errors along with the predictions themselves and the fixed effect estimates (for comparison to other models):</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># find the location of the genetic groups</span>
(ggrows &lt;-<span class="st"> </span><span class="kw">match</span>(<span class="kw">c</span>(<span class="st">&quot;foc0&quot;</span>, <span class="st">&quot;g1&quot;</span>), <span class="kw">attr</span>(listAstarAdd, <span class="st">&quot;rowNames&quot;</span>)))</code></pre>
<pre><code>## [1] 6001 6002</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># genetic group and fixed effects (with re-scaled standard errors)</span>
<span class="kw">with</span>(ggAstarRanASR, <span class="kw">cbind</span>(<span class="dt">Effect =</span> <span class="kw">c</span>(coefficients$fixed, coefficients$random[ggrows]),
    <span class="dt">seEffect =</span> <span class="kw">sqrt</span>(<span class="kw">c</span>(vcoeff$fixed, vcoeff$random[ggrows]) *<span class="st"> </span>sigma2)))</code></pre>
<pre><code>##                  Effect seEffect
## f             0.6656207 1.832498
## (Intercept)  21.3560577 2.320737
## ped(id)_foc0 -1.5578210 2.320741
## ped(id)_g1    1.5578209 2.320741</code></pre>
<p>Note the intercept in this model is estimable and so the model returns this estimate along with predicting both of the genetic group effects. The genetic group predictions, themselves, are random effects and thus are deviations from their expected value of 0. The difference between the genetic groups 3.116 agrees with the expected difference between the mean breeding values of the immigrant group (<code>3</code>) and the founder population (<code>0</code>) that was specified in the simulation.</p>
<p>The predicted total additive genetic effects (<strong>u</strong>) can be accessed from <code>ggAstarRanASR$coefficients$random[-ggrows]</code>. Here, the prediced total additive genetic effects include the genetic group effects expressed as deviations from 0. Because the order of rows in <strong>Q</strong> matches the order of individual identities in <code>ggTutorial</code>, the breeding values (<strong>a</strong>) can be calculated without any further manipulation as (eqn 6 in main text):</p>
<pre class="sourceCode r"><code class="sourceCode r">AstarRan_gHat &lt;-<span class="st"> </span><span class="kw">matrix</span>(ggAstarRanASR$coefficients$random[ggrows], <span class="dt">ncol =</span> <span class="dv">1</span>)
AstarRan_a &lt;-<span class="st"> </span>ggAstarRanASR$coefficients$random[-ggrows] -<span class="st"> </span>Q %*%<span class="st"> </span>AstarRan_gHat</code></pre>
<p>Note, if more individuals are in the pedigree than the dataset and/or the identities in the pedigree and data are ordered differently, more coding is necessary to ensure that the predicted genetic effect for a particular individual is added to the correct weighted genetic group contribution. Additionally, if more random effects are included in the model, care has to be taken in order to ensure the correct random effect predictions are extracted for the total additive genetic effects (<strong>u</strong>) and used to calculate breeding values (<strong>a</strong>). The <code>R</code> function <code>match()</code> is particularly helpful in these cases.</p>
<hr />
<!------------------------------------------------------------->
<!---------     ------------    -----------   ------------->
<h3 id="asreml-standalone">6.4.4 ASReml Standalone</h3>
<p>Here we cover four approaches to fit genetic groups in an <strong>ASReml</strong> analysis. The first two use <code>nadiv</code> functions in <code>R</code> to create <strong>Q</strong> and <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>, which are each separately included in <strong>ASReml</strong> models. The third approach uses <strong>ASReml</strong> arguments and qualifiers to rely entirely upon the <strong>ASReml</strong> capabilities for fitting genetic groups. Whereas the first three approaches are used to fit genetic groups as fixed effects, the final approach demonstrates how to fit random effects of genetic groups.</p>
<p>The preparation of the <code>ggTutorial</code> data and requisite outputs from <code>nadiv</code> in <code>R</code> will first be demonstrated before detailing the code used in the <strong>ASReml</strong> model fitting. However, the basic files necessary to fit the <strong>ASReml</strong> models without any preparation in <code>R</code> are available in the accompanying supporting files on Dryad (Wolak &amp; Reid 2016). The content of these files is summarized as:</p>
<ul>
<li><p><code>ggTutorial.dat</code> contains the <code>ggTutorial</code> data. This file contains space separated columns from a subset of columns in the original <code>data.frame</code> in the following order: <code>id</code>, <code>p</code>, <code>is</code>, <code>gen</code>, <code>f</code>, <code>foc0</code>, and <code>g1</code>. This is needed for all models fitted.</p></li>
<li><p><code>reg.ped</code> contains the pedigree and is analogous to the first three columns of <code>ggTutorial</code>. This is needed to fit a model with genetic group effects explicitly as separate fixed regressions in the model.</p></li>
<li><p><code>nadivAstar.giv</code> and <code>nadivAstar.txt</code> are needed to fit genetic group effects implicitly within the random effects of the model using <code>nadiv</code>'s <code>makeAinv()</code> in <code>R</code> to create <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> (contained in <code>nadivAstar.giv</code>). <code>nadivAstar.txt</code> provides the row names for <code>nadivAstar.giv</code> and is needed to associate levels in <code>nadivAstar.giv</code> to identities in the data <code>ggTutorial.dat</code>. Further explanation is provided below where these files are created.</p></li>
<li><p><code>asremlGG.ped</code> contains the genetic group pedigree. It is the same as <code>reg.ped</code> except two rows are added for each of the two genetic groups and individuals do not have missing values, but genetic groups, specified for missing dams and sires. This is needed to fit genetic group effects implicitly within the random effects using <strong>ASReml</strong>'s own capabilities.</p></li>
<li><p><code>ggReg.as</code>, <code>ggNadivAstarFxd.as</code>, <code>ggAsremlAstarFxd.as</code>, and <code>ggAsremlRan.as</code> are included within the folders with similar names. Each specifies a different model to run.</p></li>
</ul>
<p>To prepare the data for an animal model, all that is necessary is to calculate the coefficients of inbreeding (<em>f</em>; to minimize bias from inbreeding depression, see the last paragraph of <em>Appendix 6.4.1</em>). This calculation can be done using the <code>makeAinv()</code> function in the <code>nadiv</code> package.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(nadiv)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">ggTutorial$f &lt;-<span class="st"> </span><span class="kw">makeAinv</span>(ggTutorial[, <span class="dv">1</span>:<span class="dv">3</span>])$f</code></pre>
<h4 id="preparing-a-pedigree-with-genetic-groups-2">6.4.4.1 Preparing a pedigree with genetic groups</h4>
<p>Calculating the matrix of genetic group contributions (<strong>Q</strong>) and the augmented inverse relatedness matrix (<span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>) requires a pedigree that has genetic groups indicated instead of missing values for parents. In the <code>ggTutorial</code> data, we will assign all individuals with unknown parents in the first generation phantom parents from one genetic group (<code>foc0</code>). All individuals in subsequent generations that have unknown parents will be assigned phantom parents from a second genetic group (<code>g1</code>). Alternatively, this second group could be further divided into genetic groups based on generation. However, the data were simulated such that every immigrant has the same expected mean breeding value, regardless of the generation in which it was born. Therefore, we will stick to a total of two genetic groups (but, feel free to model more groups!).</p>
<p>First, create an object that will be the pedigree with genetic groups (<code>ggPed</code>).</p>
<pre class="sourceCode r"><code class="sourceCode r">ggPed &lt;-<span class="st"> </span>ggTutorial[, <span class="kw">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;dam&quot;</span>, <span class="st">&quot;sire&quot;</span>, <span class="st">&quot;is&quot;</span>, <span class="st">&quot;gen&quot;</span>)]
naPar &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">is.na</span>(ggPed[, <span class="dv">2</span>]))
ggPed$GG &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;NA&quot;</span>, <span class="kw">nrow</span>(ggPed))
  <span class="co"># 'focal' genetic group = &quot;foc0&quot; and 'immigrant' = &quot;g1&quot;</span>
  <span class="co"># obtained by pasting &quot;foc&quot; &amp; &quot;g&quot; with immigrant status &quot;0&quot; or &quot;1&quot;, respectively</span>
  ggPed$GG[naPar] &lt;-<span class="st"> </span><span class="kw">as.character</span>(ggPed$is[naPar])
  ggPed$GG[ggPed$GG ==<span class="st"> &quot;0&quot;</span>] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;foc&quot;</span>, ggPed$GG[ggPed$GG ==<span class="st"> &quot;0&quot;</span>])
  ggPed$GG[ggPed$GG ==<span class="st"> &quot;1&quot;</span>] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;g&quot;</span>, ggPed$GG[ggPed$GG ==<span class="st"> &quot;1&quot;</span>])
ggPed[naPar, <span class="dv">2</span>:<span class="dv">3</span>] &lt;-<span class="st"> </span>ggPed[naPar, <span class="st">&quot;GG&quot;</span>]
<span class="co"># Two rows need to be added for the genetic groups</span>
## Genetic groups will be given the missing value 0 instead of parent identities
ggPed &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">id =</span> <span class="kw">c</span>(<span class="st">&quot;foc0&quot;</span>, <span class="st">&quot;g1&quot;</span>, <span class="kw">as.character</span>(ggPed$id)),
        <span class="dt">dam =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="kw">as.character</span>(ggPed$dam)),
        <span class="dt">sire =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="kw">as.character</span>(ggPed$sire)))
<span class="kw">head</span>(ggPed)</code></pre>
<pre><code>##     id  dam sire
## 1 foc0    0    0
## 2   g1    0    0
## 3    1 foc0 foc0
## 4    2 foc0 foc0
## 5    3 foc0 foc0
## 6    4 foc0 foc0</code></pre>
<h4 id="fixed-explicit-genetic-group-effects-with-q-from-nadiv-2">6.4.4.2 Fixed explicit genetic group effects with Q (from <code>nadiv</code>)</h4>
<p>Fitting genetic group effects explicitly requires the columns of <strong>Q</strong> to be included as separate fixed covariate regressions. The code below creates <strong>Q</strong> for the <code>ggPed</code> pedigree.</p>
<!--- #FIXME  ---   ---->
<pre class="sourceCode r"><code class="sourceCode r">Q &lt;-<span class="st"> </span><span class="kw">ggcontrib</span>(ggPed[, <span class="dv">1</span>:<span class="dv">3</span>])</code></pre>
<pre><code>## Warning in numPed(pedigree): Zero in the dam column interpreted as a
## missing parent

## Warning in numPed(pedigree): Zero in the sire column interpreted as a
## missing parent</code></pre>
<!---  #END FIXME  ---- ----    ---->
<p>Note that the two warnings above (regarding zeroes being interpreted as missing dams/sires) are to be expected and should not be cause for any concern in this particular pedigree/example.</p>
<p>Now we add the columns of <strong>Q</strong> (<code>foc0</code> and <code>g1</code>) as variables in <code>ggTutorial</code> so that they can be included in a model.</p>
<pre class="sourceCode r"><code class="sourceCode r">ggTutorial &lt;-<span class="st"> </span><span class="kw">cbind</span>(ggTutorial, Q)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(ggTutorial)</code></pre>
<pre><code>## 'data.frame':    6000 obs. of  13 variables:
##  $ id     : Factor w/ 6000 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ dam    : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ sire   : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ parAvgU: num  NA NA NA NA NA NA NA NA NA NA ...
##  $ mendel : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ u      : num  -0.393 -0.675 -0.442 -1.03 -1.913 ...
##  $ r      : num  -0.0836 0.142 1.892 -1.2982 0.4668 ...
##  $ p      : num  19.5 19.5 21.5 17.7 18.6 ...
##  $ is     : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ gen    : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ f      : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ foc0   : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ g1     : num  0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<p>An important point to make is that, because the pedigree and data for <code>ggTutorial</code> have essentially the same sizes and structures (only <code>ggPed</code> now has two extra rows for the genetic groups - but these will be dropped automatically from <strong>Q</strong> by <code>ggcontrib()</code>), the genetic group coefficients from <strong>Q</strong> can be added directly to the data with <code>ggTutorial &lt;- cbind(ggTutorial, Q)</code> above. However, whenever a pedigree contains more individuals than the data (or in a different order), an intermediate step is required. Specifically, since the <strong>Q</strong> matrix contains a row for every individual in the pedigree, only the subset of rows in <strong>Q</strong> that correspond to phenotyped individuals in a dataset should be extracted and ordered according to the identities in the data.</p>
<p>Now we need to write the pedigrees and portion of the data to files in formats that <strong>ASReml</strong> can use. Note, <strong>ASReml</strong> expects pedigree columns ordered ID, Sire, Dam and we will use '0' to denote missing values (instead of NA).</p>
<pre class="sourceCode r"><code class="sourceCode r">regPed &lt;-<span class="st"> </span>ggTutorial[, <span class="dv">1</span>:<span class="dv">3</span>]
regPed[<span class="kw">is.na</span>(regPed[, <span class="dv">2</span>]), <span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">0</span>
regPed[<span class="kw">is.na</span>(regPed[, <span class="dv">3</span>]), <span class="dv">3</span>] &lt;-<span class="st"> </span><span class="dv">0</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">write.table</span>(regPed[, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>)], <span class="st">&quot;./asreml/ggReg/reg.ped&quot;</span>,
    <span class="dt">row.names =</span> <span class="ot">FALSE</span>, <span class="dt">quote =</span> <span class="ot">FALSE</span>)
asData &lt;-<span class="st"> </span>ggTutorial[, -<span class="kw">c</span>(<span class="dv">2</span>:<span class="dv">7</span>)]
<span class="kw">write.table</span>(asData, <span class="st">&quot;./asreml/ggReg/ggTutorial.dat&quot;</span>,
    <span class="dt">row.names =</span> <span class="ot">FALSE</span>, <span class="dt">quote =</span> <span class="ot">FALSE</span>)</code></pre>
<p>The fixed regressions on <code>foc0</code> and <code>g1</code> can be combined with the standard <span class="math"><strong>A</strong><sup> <strong>−</strong> <strong>1</strong></sup></span> to specify an animal model in <strong>ASReml</strong> (see also the &quot;./asreml/ggReg&quot; folder in the supporting files). Because unique solutions to the model do not exist (see discussion of estimability in <em>Appendix S6.2</em>) for the intercept, coefficient of inbreeding (<em>f</em>), and genetic group effects (<code>foc0</code> and <code>g1</code>), we fit the <code>foc0</code> genetic group as the last fixed effect. This ensures that the model sets <code>foc0</code> as a reference group and estimates the <code>g0</code> genetic group effect as a deviation from the mean breeding value in the <code>foc0</code> group.</p>
<pre><code>Fixed regression for Explicit genetic groups
 id !P
 p
 is !I 0 1
 gen 15
 f
 foc0
 g1
reg.ped !ALPHA !SKIP 1 !MAKE !GIV !DIAG
ggTutorial.dat !SKIP 1
p ~ mu f g1 foc0 !r id</code></pre>
<p>The estimate of the genetic group effects and standard errors are reported as the genetic group fixed effect regression coefficients and standard errors in the &quot;ggReg.sln&quot; file. These can be read back into <code>R</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r">regPred &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;./asreml/ggReg/ggReg.sln&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)</code></pre>
<p>so that we can see the fixed effect estimates and their standard errors:</p>
<pre class="sourceCode r"><code class="sourceCode r">regPred[<span class="dv">1</span>:<span class="dv">4</span>, ]</code></pre>
<pre><code>##   Model_Term Level Effect seEffect
## 1       foc0     1  0.000  0.00000
## 2         g1     1  3.117  0.08929
## 3          f     1  0.666  1.83200
## 4         mu     1 19.800  0.06579</code></pre>
<p>Note the software has set the <code>foc0</code> group estimate to zero in this model, implying this is the reference group and the <code>g1</code> genetic group effect is the estimated deviation from this reference. The above estimate of 3.117 agrees with the expected difference between mean breeding value in the immigrant group (<code>3</code>) and the founder population (<code>0</code>) that was specified in the simulation.</p>
<p>The predicted breeding values (<strong>a</strong>) are also reported in the &quot;ggReg.sln&quot; file (see now <code>R</code> object <code>regPred</code>) and follow below the fixed effect estimates. Because the order of rows in <strong>Q</strong> matches the order of individual identities in <code>ggTutorial</code>, the total additive genetic effects (<strong>u</strong>) can be calculated without any further manipulation as (eqn 5 in main text):</p>
<pre class="sourceCode r"><code class="sourceCode r">reg_gHat &lt;-<span class="st"> </span><span class="kw">matrix</span>(regPred[<span class="dv">1</span>:<span class="dv">2</span>, <span class="st">&quot;Effect&quot;</span>], <span class="dt">ncol =</span> <span class="dv">1</span>)
reg_u &lt;-<span class="st"> </span>Q %*%<span class="st"> </span>reg_gHat +<span class="st"> </span>regPred[-<span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">4</span>), <span class="st">&quot;Effect&quot;</span>]</code></pre>
<p>Note, if more individuals are in the pedigree than the dataset and/or the identities in the pedigree and data are ordered differently, more coding is necessary to ensure that the predicted genetic effect for a particular individual is added to the correct weighted genetic group contribution. Additionally, if more random effects are included in the model, care has to be taken in order to ensure the correct random effect predictions are extracted for the breeding values (<strong>a</strong>). The <code>R</code> function <code>match()</code> is particularly helpful in these cases.</p>
<h4 id="fixed-implicit-genetic-group-effects-with-a-from-nadiv">6.4.4.3 Fixed implicit genetic group effects with A* (from <code>nadiv</code>)</h4>
<p>Genetic group effects can be fit implicitly within the random effects when the augmented inverse relatedness matrix <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> has been supplied as a list to <strong>ASReml</strong>. The code below creates <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> for the <code>ggPed</code> pedigree and saves it as a list in the format <strong>ASReml</strong> requires.</p>
<p>First, we will calculate <strong>Q</strong> and include it in the dataset for consistency with other versions of this data.</p>
<!--- #FIXME  ---   ---->
<pre class="sourceCode r"><code class="sourceCode r">Q &lt;-<span class="st"> </span><span class="kw">ggcontrib</span>(ggPed[, <span class="dv">1</span>:<span class="dv">3</span>])</code></pre>
<pre><code>## Warning in numPed(pedigree): Zero in the dam column interpreted as a
## missing parent

## Warning in numPed(pedigree): Zero in the sire column interpreted as a
## missing parent</code></pre>
<!---  #END FIXME  ---- ----    ---->
<p>Note that the two warnings above (regarding zeroes being interpreted as missing dams/sires) are to be expected and should not be cause for any concern in this particular pedigree/example.</p>
<p>Add the columns of <strong>Q</strong> (<code>foc0</code> and <code>g1</code>) as variables in <code>ggTutorial</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">ggTutorial &lt;-<span class="st"> </span><span class="kw">cbind</span>(ggTutorial, Q)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(ggTutorial)</code></pre>
<pre><code>## 'data.frame':    6000 obs. of  13 variables:
##  $ id     : Factor w/ 6000 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ dam    : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ sire   : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ parAvgU: num  NA NA NA NA NA NA NA NA NA NA ...
##  $ mendel : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ u      : num  -0.393 -0.675 -0.442 -1.03 -1.913 ...
##  $ r      : num  -0.0836 0.142 1.892 -1.2982 0.4668 ...
##  $ p      : num  19.5 19.5 21.5 17.7 18.6 ...
##  $ is     : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ gen    : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ f      : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ foc0   : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ g1     : num  0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<p>An important point to make is that, because the pedigree and data for <code>ggTutorial</code> have essentially the same sizes and structures (only <code>ggPed</code> now has two extra rows for the genetic groups - but these will be dropped automatically from <strong>Q</strong> by <code>ggcontrib()</code>), the genetic group coefficients from <strong>Q</strong> can be added directly to the data with <code>ggTutorial &lt;- cbind(ggTutorial, Q)</code> above. However, whenever a pedigree contains more individuals than the data (or in a different order), an intermediate step is required. Specifically, since the <strong>Q</strong> matrix contains a row for every individual in the pedigree, only the subset of rows in <strong>Q</strong> that correspond to phenotyped individuals in a dataset should be extracted and ordered according to the identities in the data.</p>
<p>Now we create the sparse matrix of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> for the <code>ggPed</code> pedigree using the <code>makeAinv</code> function in the <code>nadiv</code> package.</p>
<pre class="sourceCode r"><code class="sourceCode r">listAstar &lt;-<span class="st"> </span><span class="kw">makeAinv</span>(ggPed, <span class="dt">ggroups =</span> <span class="dv">2</span>, <span class="dt">gOnTop =</span> <span class="ot">TRUE</span>)$listAinv</code></pre>
<p>In the above code, we directed <code>makeAinv()</code> to include the genetic groups on top (top-left block) of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> using <code>gOnTop = TRUE</code>. This is necessary so that <strong>ASReml</strong> solves the equations in an order that improves model convergence (see <em>Appendix 6.3</em> and its subsections). In this case, the <strong>ASReml</strong> model converges. In other pedigrees, models, and/or genetic group classifications, if singularities occur then sometimes this can be overcome by adding one (or a small value) to the diagonal elements of the group-group portion of the matrix (although see discussion of this in <em>Appendix S5</em> and cautions/considerations in <em>Appendix 6.3.2</em>). The alteration is demonstrated above in the <code>asreml</code> tutorial along with cautions and interpretations (<em>Appendix 6.4.3.4</em>). The resulting list could then be given to the standalone <strong>ASReml</strong> program much the same as we do here (see also <em>Appendix 6.4.4.5</em>). Note, the easiest approach is to adjust the genetic group diagonals of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> using the matrix returned by <code>makeAinv()</code> (i.e., object <code>Ainv</code> in the list), then convert the matrix to the list format required by <strong>ASReml</strong>.</p>
<p>Now we need to write the data (<code>ggTutorial</code>) and list of the <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> (<code>listAstar</code>) to a file for <strong>ASReml</strong>. Further, we need to write to a file all of the identity codes in the pedigree that match to the rows and columns in <code>listAstar</code>. This enables <strong>ASReml</strong> to match levels in the generalized inverse (row and column numbers of <code>listAstar</code>) to observations in <code>ggTutorial</code>. Critically, we need to include the &quot;geneticGroups&quot; attribute of <code>listAstar</code> as the first line in the file containing this list.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Write the nadiv Astar ginv list</span>
<span class="kw">write.table</span>(listAstar,
    <span class="dt">file =</span> <span class="st">&quot;./asreml/ggNadivAstarFxd/nadivAstar.giv&quot;</span>,
    <span class="dt">col.names =</span> <span class="ot">FALSE</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)
  fConn &lt;-<span class="st"> </span><span class="kw">file</span>(<span class="st">&quot;./asreml/ggNadivAstarFxd/nadivAstar.giv&quot;</span>, <span class="st">&quot;r+&quot;</span>)
  Lines &lt;-<span class="st"> </span><span class="kw">readLines</span>(fConn)
  <span class="co"># Add the !GROUPSDF *n* qualifier as the first line of the file</span>
  ngrps &lt;-<span class="st"> </span><span class="kw">attr</span>(listAstar, <span class="st">&quot;geneticGroups&quot;</span>)[<span class="dv">1</span>]
  <span class="kw">writeLines</span>(<span class="kw">c</span>(<span class="kw">paste0</span>(<span class="st">&quot;!GROUPSDF &quot;</span>, ngrps), Lines), <span class="dt">con =</span> fConn)
  <span class="kw">close</span>(fConn) 

<span class="co"># Create mapping between order of identities in listAstar and their unique codes</span>
<span class="kw">write.table</span>(ggPed[, <span class="dv">1</span>], <span class="dt">file =</span> <span class="st">&quot;./asreml/ggNadivAstarFxd/nadivAstar.txt&quot;</span>,
    <span class="dt">col.names =</span> <span class="ot">FALSE</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>, <span class="dt">quote =</span> <span class="ot">FALSE</span>)

<span class="co"># Write the data</span>
asData &lt;-<span class="st"> </span>ggTutorial[, -<span class="kw">c</span>(<span class="dv">2</span>:<span class="dv">7</span>)]
<span class="kw">write.table</span>(asData, <span class="st">&quot;./asreml/ggNadivAstarFxd/ggTutorial.dat&quot;</span>,
    <span class="dt">row.names =</span> <span class="ot">FALSE</span>, <span class="dt">quote =</span> <span class="ot">FALSE</span>)</code></pre>
<p>Now we can run the animal model in <strong>ASReml</strong> using the supplied general inverse matrix <code>listAstar</code> in the file &quot;nadivAstar.giv&quot; (see also the &quot;./asreml/ggNadivAstarFxd&quot; folder in the supporting files):</p>
<pre><code>nadiv's Astar for fixed genetic group effects implicitly within the random effects
 id !A !L nadivAstar.txt
 p
 is !I 0 1
 gen 15
 f
 foc0
 g1
nadivAstar.giv
ggTutorial.dat !SKIP 1
!LAST id 2
p ~ mu f !r giv1(id)</code></pre>
<p>Here, genetic group effects are fitted in the model using <code>nadiv</code>'s generalized inverse by including <code>giv1(id)</code> in the random effects syntax statement. The line below the data file, but before the model statement, (<code>!LAST id 2</code>) tells <strong>ASReml</strong> to fit the first two equations associated with the <code>id</code> variable (the genetic groups) last. This is done to help the model to converge (see <em>Appendix 6.3.1</em>).</p>
<p>The genetic group predictions and standard errors are reported in the &quot;ggNadivAstarFxd.sln&quot; file. These can be read back into <code>R</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r">nadivAstarFxdPred &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;./asreml/ggNadivAstarFxd/ggNadivAstarFxd.sln&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)</code></pre>
<p>so that we can see the fixed effect estimates and their standard errors along with the genetic group predictions:</p>
<pre class="sourceCode r"><code class="sourceCode r">nadivAstarFxdPred[<span class="dv">1</span>:<span class="dv">4</span>, ]</code></pre>
<pre><code>##   Model_Term Level Effect seEffect
## 1          f     1  0.666  1.83200
## 2         mu     1  0.000  0.00000
## 3   giv1(id)  foc0 19.800  0.06579
## 4   giv1(id)    g1 22.910  0.06008</code></pre>
<p>Note the software has set the intercept (<code>mu</code>) estimate to zero in this model (see discussion of estimability in <em>Appendix S6.2</em>), implying this is the reference to which the <code>foc0</code> and <code>g1</code> genetic group effects are the estimated deviations. Therefore, the predicted total additive genetic effects (<strong>u</strong>) include the overall phenotypic mean. However, the difference between the genetic group effects 3.11 agrees with the expected difference between the mean breeding values of the immigrant group (<code>3</code>) and the founder population (<code>0</code>) that was specified in the simulation.</p>
<p>The predicted total additive genetic effects (<strong>u</strong>) are also reported in the &quot;ggNadivAstarFxd.sln&quot; file (see now <code>R</code> object <code>nadivAstarFxdPred</code>) and follow below the genetic group predictions. Because the order of rows in <strong>Q</strong> matches the order of individual identities in <code>ggTutorial</code>, the predicted breeding values (<strong>a</strong>) can be calculated without any further manipulation as (eqn 6 in main text):</p>
<pre class="sourceCode r"><code class="sourceCode r">AstarFxd_gHat &lt;-<span class="st"> </span><span class="kw">matrix</span>(nadivAstarFxdPred[<span class="dv">3</span>:<span class="dv">4</span>, <span class="st">&quot;Effect&quot;</span>], <span class="dt">ncol =</span> <span class="dv">1</span>)
AstarFxd_a &lt;-<span class="st"> </span>nadivAstarFxdPred[-<span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">4</span>), <span class="st">&quot;Effect&quot;</span>] -<span class="st"> </span>Q %*%<span class="st"> </span>AstarFxd_gHat</code></pre>
<p>Note, if more individuals are in the pedigree than the dataset and/or the identities in the pedigree and data are ordered differently, more coding is necessary to ensure that the predicted genetic effect for a particular individual is added to the correct weighted genetic group contribution. Additionally, if more random effects are included in the model, care has to be taken in order to ensure the correct random effect predictions are extracted for the total additive genetic effects (<strong>u</strong>) and used to calculate breeding values (<strong>a</strong>). The <code>R</code> function <code>match()</code> is particularly helpful in these cases.</p>
<h4 id="fixed-implicit-genetic-group-effects-with-a-from-asreml">6.4.4.4 Fixed implicit genetic group effects with A* (from ASReml)</h4>
<p><strong>ASReml</strong> can fit genetic group effects implicitly within the random effects using its own function to construct <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>. First, we construct the data and pedigree files in <code>R</code>.</p>
<p>Calculate <strong>Q</strong> and include it in the dataset for consistency with other versions of this data.</p>
<!--- #FIXME  ---   ---->
<pre class="sourceCode r"><code class="sourceCode r">Q &lt;-<span class="st"> </span><span class="kw">ggcontrib</span>(ggPed[, <span class="dv">1</span>:<span class="dv">3</span>])</code></pre>
<pre><code>## Warning in numPed(pedigree): Zero in the dam column interpreted as a
## missing parent

## Warning in numPed(pedigree): Zero in the sire column interpreted as a
## missing parent</code></pre>
<!---  #END FIXME  ---- ----    ---->
<p>Note that the two warnings above (regarding zeroes being interpreted as missing dams/sires) are to be expected and should not be cause for any concern in this particular pedigree/example.</p>
<p>Add the columns of <strong>Q</strong> (<code>foc0</code> and <code>g1</code>) as variables in <code>ggTutorial</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">ggTutorial &lt;-<span class="st"> </span><span class="kw">cbind</span>(ggTutorial, Q)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(ggTutorial)</code></pre>
<pre><code>## 'data.frame':    6000 obs. of  13 variables:
##  $ id     : Factor w/ 6000 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ dam    : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ sire   : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ parAvgU: num  NA NA NA NA NA NA NA NA NA NA ...
##  $ mendel : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ u      : num  -0.393 -0.675 -0.442 -1.03 -1.913 ...
##  $ r      : num  -0.0836 0.142 1.892 -1.2982 0.4668 ...
##  $ p      : num  19.5 19.5 21.5 17.7 18.6 ...
##  $ is     : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ gen    : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ f      : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ foc0   : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ g1     : num  0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<p>An important point to make is that, because the pedigree and data for <code>ggTutorial</code> have essentially the same sizes and structures (only <code>ggPed</code> now has two extra rows for the genetic groups - but these will be dropped automatically from <strong>Q</strong> by <code>ggcontrib()</code>), the genetic group coefficients from <strong>Q</strong> can be added directly to the data with <code>ggTutorial &lt;- cbind(ggTutorial, Q)</code> above. However, whenever a pedigree contains more individuals than the data (or in a different order), an intermediate step is required. Specifically, since the <strong>Q</strong> matrix contains a row for every individual in the pedigree, only the subset of rows in <strong>Q</strong> that correspond to phenotyped individuals in a dataset should be extracted and ordered according to the identities in the data.</p>
<p>Write the pedigree containing genetic groups and the relevant portion of the data to files in formats that <strong>ASReml</strong> can use. Note, <strong>ASReml</strong> expects pedigree columns ordered ID, Sire, Dam.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Write the pedigree</span>
<span class="kw">write.table</span>(ggPed[, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>)], <span class="st">&quot;./asreml/ggAsremlAstarFxd/asremlGG.ped&quot;</span>,
    <span class="dt">row.names =</span> <span class="ot">FALSE</span>, <span class="dt">quote =</span> <span class="ot">FALSE</span>)

<span class="co"># Write the data</span>
asData &lt;-<span class="st"> </span>ggTutorial[, -<span class="kw">c</span>(<span class="dv">2</span>:<span class="dv">7</span>)]
<span class="kw">write.table</span>(asData, <span class="st">&quot;./asreml/ggAsremlAstarFxd/ggTutorial.dat&quot;</span>,
    <span class="dt">row.names =</span> <span class="ot">FALSE</span>, <span class="dt">quote =</span> <span class="ot">FALSE</span>)</code></pre>
<p>The model is specified in <strong>ASReml</strong> (see also the &quot;./asreml/ggAsremlAstarFxd&quot; folder in the supporting files):</p>
<pre><code>ASReml's Astar for fixed genetic groups implicitly within the random effects
 id !P
 p
 is !I 0 1
 gen 15
 f
 foc0
 g1
asremlGG.ped !ALPHA !SKIP 1 !MAKE !GIV !DIAG !GROUPS 2
ggTutorial.dat !SKIP 1
!LAST id 2
p ~ mu f !r id</code></pre>
<p>Here, genetic groups are specified as the top two lines of the pedigree file <code>asremlGG.ped</code> using <code>!GROUPS 2</code> as an additional qualifier to the pedigree file line. <strong>ASReml</strong> then creates <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> from the pedigree and saves this as a list in the file &quot;ggAsremlAstarFxd_A.giv&quot; (when the <code>!GIV</code> qualifier is included in the pedigree line). The line below the data file, but before the model statement, (<code>!LAST id 2</code>) tells <strong>ASReml</strong> to fit the first two equations associated with the <code>id</code> variable (the genetic groups) last. This is done to help the model to converge (see <em>Appendix 6.3.1</em>).</p>
<p>The genetic group predictions and standard errors are reported in the &quot;ggAsremlAstarFxd.sln&quot; file. These can be read back into <code>R</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r">asremlAstarFxdPred &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;./asreml/ggAsremlAstarFxd/ggAsremlAstarFxd.sln&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)</code></pre>
<p>so that we can see the fixed effect estimates and their standard errors along with the genetic group predictions:</p>
<pre class="sourceCode r"><code class="sourceCode r">asremlAstarFxdPred[<span class="dv">1</span>:<span class="dv">4</span>, ]</code></pre>
<pre><code>##   Model_Term Level Effect seEffect
## 1          f     1  0.666  1.83200
## 2         mu     1  0.000  0.00000
## 3         id  foc0 19.800  0.06579
## 4         id    g1 22.910  0.06008</code></pre>
<p>Note the software has set the intercept (<code>mu</code>) estimate to zero in this model (see discussion of estimability in <em>Appendix S6.2</em>), implying this is the reference to which the <code>foc0</code> and <code>g1</code> genetic group effects are the estimated deviations. Therefore, the predicted total additive genetic effects (<strong>u</strong>) include the overall phenotypic mean. However, the difference between the genetic group effects 3.11 agrees with the expected difference between the mean breeding values of the immigrant group (<code>3</code>) and the founder population (<code>0</code>) that was specified in the simulation.</p>
<p>The predicted total additive genetic effects (<strong>u</strong>) are also reported in the &quot;ggAsremlAstarFxd.sln&quot; file (see now <code>R</code> object <code>asremlAstarFxdPred</code>) and follow below the genetic group predictions. Because the order of rows in <strong>Q</strong> matches the order of individual identities in <code>ggTutorial</code>, the predicted breeding values (<strong>a</strong>) can be calculated without any further manipulation as (eqn 6 in main text):</p>
<pre class="sourceCode r"><code class="sourceCode r">AstarFxd_gHat &lt;-<span class="st"> </span><span class="kw">matrix</span>(asremlAstarFxdPred[<span class="dv">3</span>:<span class="dv">4</span>, <span class="st">&quot;Effect&quot;</span>], <span class="dt">ncol =</span> <span class="dv">1</span>)
AstarFxd_a &lt;-<span class="st"> </span>asremlAstarFxdPred[-<span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">4</span>), <span class="st">&quot;Effect&quot;</span>] -<span class="st"> </span>Q %*%<span class="st"> </span>AstarFxd_gHat</code></pre>
<p>Note, if more individuals are in the pedigree than the dataset and/or the identities in the pedigree and data are ordered differently, more coding is necessary to ensure that the predicted genetic effect for a particular individual is added to the correct weighted genetic group contribution. Additionally, if more random effects are included in the model, care has to be taken in order to ensure the correct random effect predictions are extracted for the total additive genetic effects (<strong>u</strong>) and used to calculate breeding values (<strong>a</strong>). The <code>R</code> function <code>match()</code> is particularly helpful in these cases.</p>
<h4 id="random-implicit-genetic-group-effects-with-a-from-asreml">6.4.4.5 Random implicit genetic group effects with A* (from ASReml)</h4>
<p>Fitting random effects of genetic groups implicity within the random effects of an animal model requires a modified augmented inverse relatendess matrix (<span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>) to be created. This can be accomplished in <code>R</code> with <code>nadiv</code> such that the object is then passed to <strong>ASReml</strong> or the built-in functions of <strong>ASReml</strong> can do this while fitting the model. Creating the modified matrix in <code>R</code> using <code>nadiv</code> has been demonstrated in <em>Appendix 6.4.3.4</em> and including such a matrix in an <strong>ASReml</strong> analysis is demonstrated in <em>Appendix 6.4.4.3</em>. Here, we demonstrate how to use <strong>ASReml</strong> to create a modified <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> for the <code>ggPed</code> pedigree that has the necessary alterations (see discussion of this in <em>Appendix S5</em> and cautions/considerations in <em>Appendix 6.3.2</em>) so the model interprets the genetic groups as random effects and fit the model all in a single execution of <strong>ASReml</strong>.</p>
<p>First, we construct the data and pedigree files in <code>R</code>. Calculate <strong>Q</strong> and include it in the dataset for consistency with other versions of this data.</p>
<!--- #FIXME  ---   ---->
<pre class="sourceCode r"><code class="sourceCode r">Q &lt;-<span class="st"> </span><span class="kw">ggcontrib</span>(ggPed[, <span class="dv">1</span>:<span class="dv">3</span>])</code></pre>
<pre><code>## Warning in numPed(pedigree): Zero in the dam column interpreted as a
## missing parent

## Warning in numPed(pedigree): Zero in the sire column interpreted as a
## missing parent</code></pre>
<!---  #END FIXME  ---- ----    ---->
<p>Note that the two warnings above (regarding zeroes being interpreted as missing dams/sires) are to be expected and should not be cause for any concern in this particular pedigree/example.</p>
<p>Add the columns of <strong>Q</strong> (<code>foc0</code> and <code>g1</code>) as variables in <code>ggTutorial</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">ggTutorial &lt;-<span class="st"> </span><span class="kw">cbind</span>(ggTutorial, Q)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(ggTutorial)</code></pre>
<pre><code>## 'data.frame':    6000 obs. of  13 variables:
##  $ id     : Factor w/ 6000 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ dam    : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ sire   : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ parAvgU: num  NA NA NA NA NA NA NA NA NA NA ...
##  $ mendel : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ u      : num  -0.393 -0.675 -0.442 -1.03 -1.913 ...
##  $ r      : num  -0.0836 0.142 1.892 -1.2982 0.4668 ...
##  $ p      : num  19.5 19.5 21.5 17.7 18.6 ...
##  $ is     : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ gen    : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ f      : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ foc0   : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ g1     : num  0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<p>An important point to make is that, because the pedigree and data for <code>ggTutorial</code> have essentially the same sizes and structures (only <code>ggPed</code> now has two extra rows for the genetic groups - but these will be dropped automatically from <strong>Q</strong> by <code>ggcontrib()</code>), the genetic group coefficients from <strong>Q</strong> can be added directly to the data with <code>ggTutorial &lt;- cbind(ggTutorial, Q)</code> above. However, whenever a pedigree contains more individuals than the data (or in a different order), an intermediate step is required. Specifically, since the <strong>Q</strong> matrix contains a row for every individual in the pedigree, only the subset of rows in <strong>Q</strong> that correspond to phenotyped individuals in a dataset should be extracted and ordered according to the identities in the data.</p>
<p>Write the pedigree containing genetic groups and the relevant portion of the data to files in formats that <strong>ASReml</strong> can use. Note, <strong>ASReml</strong> expects pedigree columns ordered ID, Sire, Dam.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Write the pedigree</span>
<span class="kw">write.table</span>(ggPed[, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>)], <span class="st">&quot;./asreml/ggAsremlRan/asremlGG.ped&quot;</span>,
    <span class="dt">row.names =</span> <span class="ot">FALSE</span>, <span class="dt">quote =</span> <span class="ot">FALSE</span>)

<span class="co"># Write the data</span>
asData &lt;-<span class="st"> </span>ggTutorial[, -<span class="kw">c</span>(<span class="dv">2</span>:<span class="dv">7</span>)]
<span class="kw">write.table</span>(asData, <span class="st">&quot;./asreml/ggAsremlRan/ggTutorial.dat&quot;</span>,
    <span class="dt">row.names =</span> <span class="ot">FALSE</span>, <span class="dt">quote =</span> <span class="ot">FALSE</span>)</code></pre>
<p>The model is specified in <strong>ASReml</strong> (see also the &quot;./asreml/ggAsremlRan&quot; folder in the supporting files):</p>
<pre><code>ASReml's Astar for random genetic groups implicitly within the random effects
 id !P
 p
 is !I 0 1
 gen 15
 f
 foc0
 g1
asremlGG.ped !ALPHA !SKIP 1 !MAKE !GIV !DIAG !GROUPS 2 !GOFFSET 0.1
ggTutorial.dat !SKIP 1
!LAST id 2
p ~ mu f !r id</code></pre>
<p>Here, genetic groups are specified as the top two lines of the pedigree file <code>asremlGG.ped</code> using <code>!GROUPS 2</code> as an additional qualifier to the pedigree file line. Further, the <code>!GOFFSET 0.1</code> qualifier to the pedigree line instructs <strong>ASReml</strong> to add <code>0.1</code> to the diagonal elements of the group-group equations in <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> (see discussion of this in <em>Appendix S5</em>, cautions/considerations in <em>Appendix 6.3.2</em>, and other examples in <em>Appendix 6.4.2.3</em> and <em>Appendix 6.4.3.4</em>). As a result of this alteration, the genetic group effects are conceptually random effects in the model. The addition of 0.1 to the diagonal element of the <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> constrains the variance in genetic group effects to be one tenth the additive genetic variance estimated by the model. A value of 0.1 may bias estimates of additive genetic variance in models of other datasets. Therefore, we advise testing values other than 0.1 (e.g., 1 or 10) and comparing estimates from these alternative models. Note that a value of 1 constrains the variance in genetic group effects to be equal to the additive genetic variance estimated by the model.</p>
<p><strong>ASReml</strong> then creates <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> from the pedigree and saves this as a list in the file &quot;ggAsremlRan_A.giv&quot; (when the <code>!GIV</code> qualifier is included in the pedigree line). The line below the data file, but before the model statement, (<code>!LAST id 2</code>) tells <strong>ASReml</strong> to fit the first two equations associated with the <code>id</code> variable (the genetic groups) last. This is done to help the model to converge (see <em>Appendix 6.3.1</em>).</p>
<p>The genetic group predictions and standard errors are reported in the &quot;ggAsremlRan.sln&quot; file. These can be read back into <code>R</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r">asremlRanPred &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;./asreml/ggAsremlRan/ggAsremlRan.sln&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)</code></pre>
<p>so that we can see the fixed effect estimates and their standard errors along with the genetic group predictions:</p>
<pre class="sourceCode r"><code class="sourceCode r">asremlRanPred[<span class="dv">1</span>:<span class="dv">4</span>, ]</code></pre>
<pre><code>##   Model_Term Level  Effect seEffect
## 1          f     1  0.6656    1.832
## 2         mu     1 21.3600    2.321
## 3         id  foc0 -1.5580    2.321
## 4         id    g1  1.5580    2.321</code></pre>
<p>Note the intercept in this model (<code>mu</code>) is estimable and so the model returns this estimate along with predicting both of the genetic group effects. The genetic group predictions, themselves, are random effects and thus are deviations from their expected value of 0. The difference between the genetic groups 3.116 agrees with the expected difference between the mean breeding values of the immigrant group (<code>3</code>) and the founder population (<code>0</code>) that was specified in the simulation.</p>
<p>The predicted total additive genetic effects (<strong>u</strong>) are also reported in the &quot;ggAsremlRan.sln&quot; file (see now <code>R</code> object <code>asremlRanPred</code>) and follow below the genetic group predictions. Here, the prediced total additive genetic effects include the genetic group effects expressed as deviations from 0. Because the order of rows in <strong>Q</strong> matches the order of individual identities in <code>ggTutorial</code>, the predicted breeding values (<strong>a</strong>) can be calculated without any further manipulation as (eqn 6 in main text):</p>
<pre class="sourceCode r"><code class="sourceCode r">AstarRan_gHat &lt;-<span class="st"> </span><span class="kw">matrix</span>(asremlRanPred[<span class="dv">3</span>:<span class="dv">4</span>, <span class="st">&quot;Effect&quot;</span>], <span class="dt">ncol =</span> <span class="dv">1</span>)
AstarRan_a &lt;-<span class="st"> </span>asremlRanPred[-<span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">4</span>), <span class="st">&quot;Effect&quot;</span>] -<span class="st"> </span>Q %*%<span class="st"> </span>AstarRan_gHat</code></pre>
<p>Note, if more individuals are in the pedigree than the dataset and/or the identities in the pedigree and data are ordered differently, more coding is necessary to ensure that the predicted genetic effect for a particular individual is added to the correct weighted genetic group contribution. Additionally, if more random effects are included in the model, care has to be taken in order to ensure the correct random effect predictions are extracted for the total additive genetic effects (<strong>u</strong>) and used to calculate breeding values (<strong>a</strong>). The <code>R</code> function <code>match()</code> is particularly helpful in these cases.</p>
<hr />
<!------------------------------------------------------------->
<!---------     ------------    -----------   ------------->
<h3 id="wombat">6.4.5 WOMBAT</h3>
<p>Here are three approaches to fit genetic groups in a <strong>WOMBAT</strong> analysis. All three require some preparation using the <code>nadiv</code> functions in <code>R</code>. However, only the explicit regression on the genetic group covariate includes genetic groups as fixed effects. The second and third examples below include genetic groups as random effects in the model. It should be noted that <strong>WOMBAT</strong> sets up the mixed model slightly differently than the previous software programs. Notably, <strong>WOMBAT</strong> fits response variables and covariates as deviations from the mean response and mean of each covariate, respectively. Thus, regression coefficients are equivalent, but have slightly different estimates/interpretations from the estimates in the above tutorials. The preparation of the <code>ggTutorial</code> data and requisite outputs from <code>nadiv</code> in <code>R</code> will first be demonstrated before detailing the code used in the <strong>WOMBAT</strong> model fitting. However, the basic files necessary to fit the <strong>WOMBAT</strong> models without any preparation in <code>R</code> are available in the accompanying supporting files on Dryad (Wolak &amp; Reid 2016). The content of these files is:</p>
<ul>
<li><p><code>ggTutorial.d</code> contains the re-coded <code>ggTutorial</code> data. A value of 10000 has been added to the <code>id</code> to allow unique integer codes for the genetic groups (<strong>WOMBAT</strong> requires integer identities). This file contains space separated columns from a subset of the columns in the original <code>data.frame</code> in the following order: <code>id</code>, <code>p</code>, <code>is</code>, <code>gen</code>, <code>f</code>, <code>foc0</code>, and <code>g1</code>. This is needed for all three types of models fitted.</p></li>
<li><p><code>wombatPed.d</code> contains the pedigree and is analogous to the first three columns of <code>ggTutorial</code></p></li>
<li><p><code>ggReg.par</code>, <code>ggNadivAstarRan.par</code>, and <code>ggWombatRan.par</code> are included within each folder and each specifies a separate model to run.</p></li>
<li><p><code>id.gin</code> contains an inverse covariance matrix, in list format. This is either the <code>nadiv</code> created <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> or <span class="math"><strong>A</strong><sup> <strong>−</strong> <strong>1</strong></sup></span>, depending on the analysis.</p></li>
<li><p><code>id.codes</code> contains the mapping of running integers to the particular name of individuals in <code>ggTutorial.d</code>. For <strong>WOMBAT</strong>'s implementation of a genetic group analysis, this file must contain an extra column (dummy column in these analyses) that contains an integer code specifying if a genotype is available, as well as extra columns with the <strong>Q</strong> matrix (which must be constructed within <code>nadiv</code> as there is no function to do this in <strong>WOMBAT</strong>).</p></li>
</ul>
<p>To prepare the data for an animal model, all that is necessary is to calculate the coefficients of inbreeding (<em>f</em>; to minimize bias from inbreeding depression, see the last paragraph of <em>Appendix 6.4.1</em>). This calculation can be done using the <code>makeAinv()</code> function in the <code>nadiv</code> package.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(nadiv)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">ggTutorial$f &lt;-<span class="st"> </span><span class="kw">makeAinv</span>(ggTutorial[, <span class="dv">1</span>:<span class="dv">3</span>])$f</code></pre>
<h4 id="preparing-a-pedigree-with-genetic-groups-3">6.4.5.1 Preparing a pedigree with genetic groups</h4>
<p>Calculating the matrix of genetic group contributions (<strong>Q</strong>) and the augmented inverse relatedness matrix (<span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>) requires a pedigree that has genetic groups indicated instead of missing values for parents. In the <code>ggTutorial</code> data, we will assign all individuals with unknown parents in the first generation phantom parents from one genetic group (<code>foc0</code>). All individuals in subsequent generations that have unknown parents will be assigned phantom parents from a second genetic group (<code>g1</code>). Alternatively, this second group could be further divided into genetic groups based on generation. However, the data were simulated such that every immigrant has the same expected mean breeding value, regardless of the generation in which it was born. Therefore, we will stick to a total of two genetic groups (but, feel free to model more than 2 groups!).</p>
<p>Create an object that will be the pedigree with genetic groups (<code>ggPed</code>).</p>
<pre class="sourceCode r"><code class="sourceCode r">ggPed &lt;-<span class="st"> </span>ggTutorial[, <span class="kw">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;dam&quot;</span>, <span class="st">&quot;sire&quot;</span>, <span class="st">&quot;is&quot;</span>, <span class="st">&quot;gen&quot;</span>)]
naPar &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">is.na</span>(ggPed[, <span class="dv">2</span>]))
ggPed$GG &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;NA&quot;</span>, <span class="kw">nrow</span>(ggPed))
  <span class="co"># 'focal' genetic group = &quot;foc0&quot; and 'immigrant' = &quot;g1&quot;</span>
  <span class="co"># obtained by pasting &quot;foc&quot; &amp; &quot;g&quot; with immigrant status &quot;0&quot; or &quot;1&quot;, respectively</span>
  ggPed$GG[naPar] &lt;-<span class="st"> </span><span class="kw">as.character</span>(ggPed$is[naPar])
  ggPed$GG[ggPed$GG ==<span class="st"> &quot;0&quot;</span>] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;foc&quot;</span>, ggPed$GG[ggPed$GG ==<span class="st"> &quot;0&quot;</span>])
  ggPed$GG[ggPed$GG ==<span class="st"> &quot;1&quot;</span>] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;g&quot;</span>, ggPed$GG[ggPed$GG ==<span class="st"> &quot;1&quot;</span>])
ggPed[naPar, <span class="dv">2</span>:<span class="dv">3</span>] &lt;-<span class="st"> </span>ggPed[naPar, <span class="st">&quot;GG&quot;</span>]</code></pre>
<p>Note, the approach and format of the pedigree below is different from the <code>Q1988sub</code> pedigree (<em>Appendix 6.1</em>) - mostly because the format below makes it easier to specify genetic groups in a pedigree for this particular case, but partly to illustrate the flexibility of <code>nadiv</code> functions. To be more specific, the <code>Q1988sub</code> pedigree contained two extra rows for the two genetic groups. The <code>ggroups</code> argument to <code>makeAinv()</code> supplied an integer indicating how many rows at the begining of the pedigree contained genetic groups and not individuals. However, below no extra rows are added to the pedigree and the character vector given to the <code>ggroups</code> argument in both <code>ggcontrib()</code> and <code>makeAinv()</code> specifies the unique genetic groups.</p>
<h4 id="fixed-explicit-genetic-group-effects-with-q-from-nadiv-3">6.4.5.2 Fixed explicit genetic group effects with Q (from <code>nadiv</code>)</h4>
<p>Fitting genetic group effects explicitly requires the columns of <strong>Q</strong> to be included as separate fixed covariate regressions. The code below creates <strong>Q</strong> for the <code>ggPed</code> pedigree and adds the columns (<code>foc0</code> and <code>g1</code>) as variables in <code>ggTutorial</code> so that they can be included in a model.</p>
<pre class="sourceCode r"><code class="sourceCode r">Q &lt;-<span class="st"> </span><span class="kw">ggcontrib</span>(ggPed[, <span class="dv">1</span>:<span class="dv">3</span>], <span class="dt">ggroups =</span> <span class="kw">c</span>(<span class="st">&quot;foc0&quot;</span>, <span class="st">&quot;g1&quot;</span>))</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">ggTutorial &lt;-<span class="st"> </span><span class="kw">cbind</span>(ggTutorial, Q)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(ggTutorial)</code></pre>
<pre><code>## 'data.frame':    6000 obs. of  13 variables:
##  $ id     : Factor w/ 6000 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ dam    : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ sire   : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ parAvgU: num  NA NA NA NA NA NA NA NA NA NA ...
##  $ mendel : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ u      : num  -0.393 -0.675 -0.442 -1.03 -1.913 ...
##  $ r      : num  -0.0836 0.142 1.892 -1.2982 0.4668 ...
##  $ p      : num  19.5 19.5 21.5 17.7 18.6 ...
##  $ is     : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ gen    : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ f      : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ foc0   : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ g1     : num  0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<p>An important point to make is that, because the pedigree and data for <code>ggTutorial</code> have essentially the same sizes and structures, the genetic group coefficients from <strong>Q</strong> can be added directly to the data with <code>ggTutorial &lt;- cbind(ggTutorial, Q)</code> above. However, whenever a pedigree contains more individuals than the data (or in a different order), an intermediate step is required. Specifically, since the <strong>Q</strong> matrix contains a row for every individual in the pedigree, only the subset of rows in <strong>Q</strong> that correspond to phenotyped individuals in a dataset should be extracted and ordered according to the identities in the data.</p>
<p>Now we need to write the pedigree and portion of the data to files in formats that <strong>WOMBAT</strong> can use. Also, for consistency with analyses below, we will add a constant value of 10000 to the integer <code>id</code>s.</p>
<pre class="sourceCode r"><code class="sourceCode r">IDaddDF &lt;-<span class="st"> </span>ggTutorial[, -<span class="kw">c</span>(<span class="dv">4</span>:<span class="dv">7</span>)]
IDaddDF[, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">as.character</span>(IDaddDF[, <span class="dv">1</span>])) +<span class="st"> </span><span class="dv">10000</span>
IDaddDF[, <span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">as.character</span>(IDaddDF[, <span class="dv">2</span>])) +<span class="st"> </span><span class="dv">10000</span>
IDaddDF[, <span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">as.character</span>(IDaddDF[, <span class="dv">3</span>])) +<span class="st"> </span><span class="dv">10000</span>

IDaddPed &lt;-<span class="st"> </span>IDaddDF[, <span class="dv">1</span>:<span class="dv">3</span>]
IDaddPed[<span class="kw">is.na</span>(IDaddPed[, <span class="dv">2</span>]), <span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">0</span>
IDaddPed[<span class="kw">is.na</span>(IDaddPed[, <span class="dv">3</span>]), <span class="dv">3</span>] &lt;-<span class="st"> </span><span class="dv">0</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">write.table</span>(IDaddDF[, -<span class="kw">c</span>(<span class="dv">2</span>:<span class="dv">3</span>)], <span class="st">&quot;./wombat/ggTutorial.d&quot;</span>, <span class="dt">col.names =</span> <span class="ot">FALSE</span>,
    <span class="dt">row.names =</span> <span class="ot">FALSE</span>)
<span class="kw">write.table</span>(IDaddPed, <span class="st">&quot;./wombat/wombatPed.d&quot;</span>, <span class="dt">col.names =</span> <span class="ot">FALSE</span>,
    <span class="dt">row.names =</span> <span class="ot">FALSE</span>)</code></pre>
<p>The fixed regressions on <code>foc0</code> and <code>g1</code> can be combined with the standard <span class="math"><strong>A</strong><sup> <strong>−</strong> <strong>1</strong></sup></span> to specify an animal model in <strong>WOMBAT</strong> (see also the &quot;./wombat/ggReg&quot; folder in the supporting files). Because unique solutions to the model do not exist (see discussion of estimability in <em>Appendix S6.2</em>) for the coefficient of inbreeding (<em>f</em>) and genetic group effects (<code>foc0</code> and <code>g1</code>), we fit the <code>foc0</code> genetic group as the last fixed effect. This ensures that the model sets <code>foc0</code> as a reference group and estimates the <code>g0</code> genetic group effect as a deviation from the mean breeding value in the <code>foc0</code> group.</p>
<pre><code>COM Explicit genetic groups fitted as Fixed regressions
PED ../wombatPed.d
DAT ../ggTutorial.d
  id 6000
  p
  is 2
  gen 15
  f
  foc0
  g1
end
ANAL UNI
MODEL
 COV f(1)
 COV g1(1)
 COV foc0(1)
 RAN id NRM
 TR p
END
VAR id 1
 0.5
VAR error 1
 0.5
SPECIAL
  COVZER f(1) FIT
  COVZER foc0(1) FIT
  COVZER g1(1) FIT
END</code></pre>
<p>Note the last <code>SPECIAL</code> section, which is necessary because both the coefficient of inbreeding (<em>f</em>) and the genetic group contributions (<code>foc0</code> and <code>g1</code>) have values of zero that are meaningful (i.e., these zeroes do not indicate missing values).</p>
<p>Estimates of the genetic group effects are reported in the &quot;./wombat/ggReg/FixSolutions.out&quot; file. Note the software has set the <code>foc0</code> group estimate to zero in this model, implying this is the reference group and the <code>g1</code> genetic group effect is the estimated deviation. The estimate of 3.098 agrees with the expected difference between mean breeding value in the immigrant group (<code>3</code>) and the founder population (<code>0</code>) that was specified in the simulation.</p>
<p>The predicted breeding values (<strong>a</strong>) are also reported in the &quot;RnSoln_id.dat&quot; file.</p>
<h4 id="random-implicit-genetic-group-effects-with-a-from-nadiv-2">6.4.5.3 Random implicit genetic group effects with A* (from <code>nadiv</code>)</h4>
<p>Fitting genetic group effects implicitly within the random effects requires the list format of a modified <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> to be supplied to <strong>WOMBAT</strong>. Currently, there is no option to incorporate the number of genetic groups fitted implicitly when the software calculates the residual degrees of freedom. Residual degrees of freedom that incorporate the number of genetic groups are needed to calculate the residual variance and the log-likelihood for a model in which genetic groups are considered fixed effects (e.g., see how the residual degrees of freedom are adjusted in an <code>asreml</code> analysis in <em>Appendix 6.4.3.4</em>). However, the number of genetic groups are not considered in these same calculations when genetic groups are considered random effects. Therefore, we demonstrate fitting genetic groups implicitly when groups are treated as random effects.</p>
<p>Fitting random effects of genetic groups implicity within the random effects of an animal model requires the augmented inverse relatendess matrix (<span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>) to be supplied as a list. First, we create the sparse matrix of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> for the <code>ggPed</code> pedigree using the <code>makeAinv</code> function in the <code>nadiv</code> package in <code>R</code>, then make the necessary alterations (see discussion of this in <em>Appendix S5</em> and cautions/considerations in <em>Appendix 6.3.2</em>) so the model interprets the genetic groups as random effects, convert the sparse matrix to a list, and fit the model.</p>
<p>The code below creates <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> for the <code>ggPed</code> pedigree, the data file, and <code>id.codes</code> so that the genetic group and identities in <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> can be associated with identities in the data file. We will also calculate <strong>Q</strong> and include it in the dataset for consistency with other versions of this data.</p>
<pre class="sourceCode r"><code class="sourceCode r">Q &lt;-<span class="st"> </span><span class="kw">ggcontrib</span>(ggPed[, <span class="dv">1</span>:<span class="dv">3</span>], <span class="dt">ggroups =</span> <span class="kw">c</span>(<span class="st">&quot;foc0&quot;</span>, <span class="st">&quot;g1&quot;</span>))
ggTutorial &lt;-<span class="st"> </span><span class="kw">cbind</span>(ggTutorial, Q)</code></pre>
<p>An important point to make is that, because the pedigree and data for <code>ggTutorial</code> have essentially the same sizes and structures (only <code>ggPed</code> now has two extra rows for the genetic groups - but these will be dropped automatically from <strong>Q</strong> by <code>ggcontrib()</code>), the genetic group coefficients from <strong>Q</strong> can be added directly to the data with <code>ggTutorial &lt;- cbind(ggTutorial, Q)</code> above. However, whenever a pedigree contains more individuals than the data (or in a different order), an intermediate step is required. Specifically, since the <strong>Q</strong> matrix contains a row for every individual in the pedigree, only the subset of rows in <strong>Q</strong> that correspond to phenotyped individuals in a dataset should be extracted and ordered according to the identities in the data.</p>
<p>Next create <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>:</p>
<pre class="sourceCode r"><code class="sourceCode r">Astar &lt;-<span class="st"> </span><span class="kw">makeAinv</span>(ggPed[, <span class="dv">1</span>:<span class="dv">3</span>], <span class="dt">ggroups =</span> <span class="kw">c</span>(<span class="st">&quot;foc0&quot;</span>, <span class="st">&quot;g1&quot;</span>), <span class="dt">gOnTop =</span> <span class="ot">TRUE</span>)$Ainv</code></pre>
<p>Next we add a small value to the diagonal elements of the group-group portion of the matrix. As a result of this alteration, the genetic group effects are conceptually random effects in the model. Below, we add 0.1 to the diagonal element of the <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> which will constrain the variance in genetic group effects to be one tenth the additive genetic variance estimated by the model. A value of 0.1 may bias estimates of additive genetic variance in models of other datasets. Therefore, we advise testing values other than 0.1 (e.g., 1 or 10) and comparing estimates from these alternative models. Note that a value of 1 constrains the variance in genetic group effects to be equal to the additive genetic variance estimated by the model.</p>
<p>The easiest approach is to adjust the genetic group diagonals of <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>, and this is why we stored the matrix returned by <code>makeAinv()</code> above (i.e., object <code>Ainv</code> in the list). Once the additions are made, we can then convert the matrix to the list format required by <code>asreml</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">AstarAdd &lt;-<span class="st"> </span>Astar
(ggrows &lt;-<span class="st"> </span><span class="kw">match</span>(<span class="kw">c</span>(<span class="st">&quot;foc0&quot;</span>, <span class="st">&quot;g1&quot;</span>), <span class="kw">dimnames</span>(AstarAdd)[[<span class="dv">1</span>]]))</code></pre>
<pre><code>## [1] 1 2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">diag</span>(AstarAdd)[ggrows] &lt;-<span class="st"> </span><span class="kw">diag</span>(AstarAdd)[ggrows] +<span class="st"> </span><span class="fl">0.1</span>
Astar[ggrows, ggrows]</code></pre>
<pre><code>## 2 x 2 sparse Matrix of class &quot;dgCMatrix&quot;
##             
## foc0 400   .
## g1     . 520</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">AstarAdd[ggrows, ggrows]</code></pre>
<pre><code>## 2 x 2 sparse Matrix of class &quot;dgCMatrix&quot;
##                 
## foc0 400.1   .  
## g1     .   520.1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># convert to the list format using `nadiv::sm2list()`</span>
listAstarAdd &lt;-<span class="st"> </span><span class="kw">sm2list</span>(AstarAdd, <span class="dt">rownames =</span> <span class="kw">rownames</span>(AstarAdd))</code></pre>
<p>Now we need to write the data, modified <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> list, and identity codes to files in formats that <strong>WOMBAT</strong> can use. Also, for consistency with analyses below, we will add a constant value of 10000 to the integer <code>id</code>s.</p>
<pre class="sourceCode r"><code class="sourceCode r">IDaddDF &lt;-<span class="st"> </span>ggTutorial[, -<span class="kw">c</span>(<span class="dv">2</span>:<span class="dv">7</span>)]
IDaddDF[, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">as.character</span>(IDaddDF[, <span class="dv">1</span>])) +<span class="st"> </span><span class="dv">10000</span>
<span class="kw">write.table</span>(IDaddDF[, -<span class="kw">c</span>(<span class="dv">2</span>:<span class="dv">3</span>)], <span class="st">&quot;./wombat/ggTutorial.d&quot;</span>, <span class="dt">col.names =</span> <span class="ot">FALSE</span>,
    <span class="dt">row.names =</span> <span class="ot">FALSE</span>)

<span class="co"># Write the general inverse of A* to file, note the re-ordering of first two columns</span>
## First, calculate the log determinant (see note below)
AstarAddLogdet &lt;-<span class="st"> </span>-<span class="dv">1</span> *<span class="st"> </span><span class="kw">determinant</span>(AstarAdd, <span class="dt">logarithm =</span> <span class="ot">TRUE</span>)$modulus[<span class="dv">1</span>]
<span class="kw">write.table</span>(listAstarAdd[, <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>)], <span class="st">&quot;./wombat/ggNadivAstarRan/id.gin&quot;</span>,
    <span class="dt">col.names =</span> <span class="ot">FALSE</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)
  fConn &lt;-<span class="st"> </span><span class="kw">file</span>(<span class="st">&quot;./wombat/ggNadivAstarRan/id.gin&quot;</span>, <span class="st">&quot;r+&quot;</span>)
  Lines &lt;-<span class="st"> </span><span class="kw">readLines</span>(fConn)
<span class="co"># Add the log-determinant as the first line of the file</span>
  <span class="kw">writeLines</span>(<span class="kw">c</span>(AstarAddLogdet, Lines), <span class="dt">con =</span> fConn)
  <span class="kw">close</span>(fConn) 

<span class="co"># Create mapping between order of identities and their unique codes</span>
## including 2 genetic groups
id.codes &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">seq</span>(<span class="dv">1</span>, <span class="kw">max</span>(listAstarAdd[, <span class="dv">1</span>:<span class="dv">2</span>]), <span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">10000</span> +<span class="st"> </span><span class="kw">seq</span>(<span class="kw">nrow</span>(ggTutorial))))
<span class="kw">write.table</span>(id.codes, <span class="st">&quot;./wombat/ggNadivAstarRan/id.codes&quot;</span>, <span class="dt">col.names =</span> <span class="ot">FALSE</span>,
    <span class="dt">row.names =</span> <span class="ot">FALSE</span>)</code></pre>
<p>Note above that we added a step to calculate the log-determinant of the modified <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span>. <strong>WOMBAT</strong> requires this as the first line of a <code>.gin</code> (generalized inverse) file (note this is the log-determinant of the non-inverse matrix, which can be calculated from the inverse).</p>
<p>The animal model in <strong>WOMBAT</strong> using the supplied general inverse matrix <span class="math"><strong>A</strong><sup> <strong>*</strong> </sup></span> (see also the &quot;./wombat/ggNadivAstarRan&quot; folder in the supporting files):</p>
<pre><code>COM Random genetic groups fitted implicitly using Astar from nadiv
DAT ../ggTutorial.d
  id 6002
  p
  is 2
  gen 15
  f
  foc0
  g1
end
ANAL UNI
MODEL
 COV  f(1)
 RAN  id    GIN
 TR   p
END
VAR id 1
 0.5
VAR error 1
 0.5
SPECIAL
  COVZER f(1) FIT
END</code></pre>
<p>Note the last <code>SPECIAL</code> section, which is necessary because the coefficient of inbreeding (<em>f</em>) has values of zero that are meaningful (i.e., these zeroes do not indicate missing values).</p>
<p>The genetic group effect predictions are reported as the first two values in the &quot;./wombat/ggNadivAstarRan/RnSoln_id.dat&quot; file. The genetic group predictions are random effects and thus are deviations from their expected value of zero. The difference between the genetic groups 3.117 agrees with the expected difference between the mean breeding values of the immigrant group (<code>3</code>) and the founder population (<code>0</code>) that was specified in the simulation.</p>
<p>The predicted total additive genetic effects (<strong>u</strong>) are also reported in the &quot;./wombat/ggNadivAstarRan/RnSoln_id.dat&quot; file. Here, the prediced total additive genetic effects include the genetic group effects expressed as deviations from 0.</p>
<h4 id="wombats-genetic-groups-random-group-effects-with-q-from-nadiv">6.4.5.4 WOMBAT's genetic groups (Random group effects with Q from <code>nadiv</code>)</h4>
<p>Fitting genetic group effects using <strong>WOMBAT</strong>'s own functionality still requires calculating and supplying <strong>Q</strong>. Although <strong>Q</strong> is supplied, genetic groups are included implicitly within the random effects. Further, the genetic group effects themselves are treated as random effects with a variance among group effects that is estimated by the model.</p>
<p><strong>WOMBAT</strong> does not provide a function to calculate <strong>Q</strong>, so we calculate it using <code>nadiv</code>'s <code>ggcontrib()</code> function and provide <span class="math"><strong>A</strong><sup> <strong>−</strong> <strong>1</strong></sup></span> as a generalized inverse. <strong>WOMBAT</strong> can be used to create <span class="math"><strong>A</strong><sup> <strong>−</strong> <strong>1</strong></sup></span>, but here we will use the <code>makeAinv()</code> function in <code>nadiv</code>. For more details, see example 18 supplied with <strong>WOMBAT</strong>, particularly the pdf file entitled &quot;RNote_WOMBATS2Step.pdf&quot; that is included within the Example 18 folder and the &quot;wombat.par&quot; file in the folder &quot;~/Example18/C&quot;.</p>
<p>The code below creates <span class="math"><strong>A</strong><sup> <strong>−</strong> <strong>1</strong></sup></span> for the <code>ggPed</code> pedigree and creates the data file and <code>id.codes</code> that contains <strong>Q</strong> (we also include the columns of <strong>Q</strong> in the data file for consistency with other versions of this data set).</p>
<pre class="sourceCode r"><code class="sourceCode r">Q &lt;-<span class="st"> </span><span class="kw">ggcontrib</span>(ggPed[, <span class="dv">1</span>:<span class="dv">3</span>], <span class="dt">ggroups =</span> <span class="kw">c</span>(<span class="st">&quot;foc0&quot;</span>, <span class="st">&quot;g1&quot;</span>))</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">ggTutorial &lt;-<span class="st"> </span><span class="kw">cbind</span>(ggTutorial, Q)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">AinvOut &lt;-<span class="st"> </span><span class="kw">makeAinv</span>(ggTutorial[, <span class="dv">1</span>:<span class="dv">3</span>], <span class="dt">det =</span> <span class="ot">TRUE</span>)
listAstar &lt;-<span class="st"> </span><span class="kw">sm2list</span>(AinvOut$Ainv)
AinvLogdet &lt;-<span class="st"> </span>AinvOut$logDet</code></pre>
<p>Note above we told <code>makeAinv()</code> to calculate the log-determinant. <strong>WOMBAT</strong> requires this as the first line of a <code>.gin</code> (generalized inverse) file (note this is the log-determinant of the non-inverse matrix <strong>A</strong>, which <code>nadiv</code> calculates when forming the inverse - here <span class="math"><strong>A</strong><sup> <strong>−</strong> <strong>1</strong></sup></span>). Now we need to write the data, <span class="math"><strong>A</strong><sup> <strong>−</strong> <strong>1</strong></sup></span> list, and identity codes to files in formats that <strong>WOMBAT</strong> can use. Also, for consistency with other analyses, we will add a constant value of 10000 to the integer <code>id</code>s.</p>
<pre class="sourceCode r"><code class="sourceCode r">IDaddDF &lt;-<span class="st"> </span>ggTutorial[, -<span class="kw">c</span>(<span class="dv">2</span>:<span class="dv">7</span>)]
IDaddDF[, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">as.character</span>(IDaddDF[, <span class="dv">1</span>])) +<span class="st"> </span><span class="dv">10000</span>
<span class="kw">write.table</span>(IDaddDF[, -<span class="kw">c</span>(<span class="dv">2</span>:<span class="dv">3</span>)], <span class="st">&quot;./wombat/ggTutorial.d&quot;</span>, <span class="dt">col.names =</span> <span class="ot">FALSE</span>,
    <span class="dt">row.names =</span> <span class="ot">FALSE</span>)

<span class="co"># Write the general inverse of A^-1 to file, note the re-ordering of first two columns</span>
<span class="kw">write.table</span>(listAinv[, <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>)], <span class="st">&quot;./wombat/ggWombatRan/id.gin&quot;</span>,
    <span class="dt">col.names =</span> <span class="ot">FALSE</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)
  fConn &lt;-<span class="st"> </span><span class="kw">file</span>(<span class="st">&quot;./wombat/ggWombatRan/id.gin&quot;</span>, <span class="st">&quot;r+&quot;</span>)
  Lines &lt;-<span class="st"> </span><span class="kw">readLines</span>(fConn)
<span class="co"># Add the log-determinant as the first line of the file</span>
  <span class="kw">writeLines</span>(<span class="kw">c</span>(AinvLogdet, Lines), <span class="dt">con =</span> fConn)
  <span class="kw">close</span>(fConn) 

<span class="co"># Create mapping between order of identities and their unique codes</span>
## including 2 genetic groups
## also add &quot;dummy&quot; column to indicate no genotypes available (1)
## Add Q matrix as final columns
id.codes &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">6000</span>), <span class="dv">10000</span> +<span class="st"> </span><span class="kw">seq</span>(<span class="kw">nrow</span>(ggTutorial)), <span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">6000</span>), <span class="kw">round</span>(<span class="dv">10000</span>*Q, <span class="dv">0</span>))
<span class="kw">write.table</span>(id.codes, <span class="st">&quot;./wombat/ggWombatRan/id.codes&quot;</span>, <span class="dt">col.names =</span> <span class="ot">FALSE</span>,
    <span class="dt">row.names =</span> <span class="ot">FALSE</span>)</code></pre>
<p>Note that <strong>WOMBAT</strong> wants the genetic group contributions in the <code>id.codes</code> file as an integer. Therefore, we have multiplied <strong>Q</strong> by a large number (10000 used above) and then rounded these to the nearest whole number. This scaling factor of 10000 will need to be indicated in the parameter file (&quot;ggWombatRan.par&quot;). The animal model in <strong>WOMBAT</strong> is then (see also the &quot;./wombat/ggWombatRan&quot; folder in the supporting files):</p>
<pre><code>COM WOMBATs genetic groups (random genetic group effects with Q from `nadiv`)
DAT ../ggTutorial.d
  id 6000
  p
  is 2
  gen 15
  f
  foc0
  g1
end
ANAL UNI
MODEL
  COV   f(1)
  SUBJ  id
  RAN   id     GIN
  RAN   ggrps  IDE
  TR    p
END
VAR id 1
 0.5
VAR ggrps 1
 1.0
VAR error 1
 0.5
SPECIAL
  COVZER f(1) FIT
END
SPECIAL
  GENGROUPS ggrps 2 10000
END</code></pre>
<p>Here, genetic groups are specified as their own random effect in the model as <code>ggrps</code> with a diagonal covariance matrix specified (<code>IDE</code>). Thus, genetic group effects are conceptually treated as random effects (<em>Appendix S1</em>) in the model. Note the <code>SPECIAL</code> sections, which are necessary because the coefficient of inbreeding (<em>f</em>) has values of zero that are meaningful (i.e., these zeroes do not indicate missing values) and for fitting genetic groups. The genetic group <code>SPECIAL</code> section indicates the scaling factor by which we multiplied elements in <strong>Q</strong> that were supplied in the file &quot;./wombat/ggWombatRan/id.codes&quot;.</p>
<p>The variance estimates in &quot;./wombat/ggWombatRan/SumEstimates.out&quot; match the simulated values for the <code>id</code> and residual terms. The estimated variance for the genetic group term (<code>ggrps</code>) is approximately <code>2</code>. All other simulated values are recovered in this analysis (model estimates match simulated values).</p>
<p>The genetic group effect predictions are reported in the &quot;./wombat/ggWombatRan/RnSoln_ggrps.dat&quot; file. The genetic group predictions are random effects and thus are deviations from their expected value of zero. The difference between the genetic groups 3.111 agrees with the expected difference between the mean breeding values of the immigrant group (<code>3</code>) and the founder population (<code>0</code>) that was specified in the simulation.</p>
<p>The predicted total additive genetic effects (<strong>u</strong>) are reported in the &quot;./wombat/ggWombatRan/RnSoln_id.dat&quot; file. Here, the prediced total additive genetic effects include the genetic group effects expressed as deviations from 0.</p>
<h2 id="references-appendix-s6">References: Appendix S6</h2>
<p>Butler, D.G., Cullis, B.R., Gilmour, A.R. &amp; Gogel, B.J. (2009) asreml: asreml() fits the linear mixed model. R package version 3.0. www.vsni.co.uk.</p>
<p>Davis, T.A. (2006) Direct Methods for Sparse Linear Systems. SIAM, Philadelphia.</p>
<p>Gilmour, A.R. (2005) Developments in utilizing pedigrees in genetic analysis within ASReml. Proceedings of the Association for the Advancement of Animal Breeding and Genetics, pp. 290–293.</p>
<p>Gilmour, A.R. (2010) Handling non positive definite relationship matrices in mixed models. 9th World Congress on Genetics Applied to Livestock Production, pp. 1–4. Leipzig, Germany.</p>
<p>Gilmour, A.R., Gogel, B.J., Cullis, B.R., Welham, S.J. &amp; Thompson, R. (2014) ASReml 4.1 user guide.</p>
<p>Hadfield, J.D. (2010) MCMC methods for multi-response generalized linear mixed models: the MCMCglmm R package. Journal of Statistical Software, 33, 1–22.</p>
<p>Hadfield, J.D., Wilson, A.J., Garant, D., Sheldon, B.C. &amp; Kruuk, L.E.B. (2010) The misuse of BLUP in ecology and evolution. American Naturalist, 175, 116–125.</p>
<p>Henderson, C.R. (1976) A simple method for computing the inverse of a numerator relationship matrix used in prediction of breeding values. Biometrics, 32, 69–83.</p>
<p>Kennedy, B.W., Schaeffer, L.R. &amp; Sorensen, D.A. (1988) Genetic properties of animal models. Journal of Dairy Science, 71, 17–26.</p>
<p>Lynch, M. &amp; Walsh, B. (1998) Genetics and Analysis of Quantitative Traits. Sinauer Associates, Incorporated, Sunderland, MA.</p>
<p>Meuwissen, T.H.E. &amp; Luo, Z. (1992) Computing inbreeding coefficients in large populations. Genetics, Selection, Evolution, 24, 305–313.</p>
<p>Meyer, K. (2007) WOMBAT - a tool for mixed model analyses in quantitative genetics by restricted maximum likelihood (REML). Journal of Zhejiang University. Science. B, 8, 815–821.</p>
<p>Mrode, R.A. (2005) Linear Models for the Prediction of Animal Breeding Values, 2nd ed. CABI Publishing, Cambridge, MA.</p>
<p>Oikawa, T. &amp; Yasuda, K. (2009) Inclusion of genetically identical animals to a numerator relationship matrix and modification of its inverse. Genetics, Selection, Evolution, 41, 25.</p>
<p>Quaas, R.L. (1976) Computing the diagonal elements and inverse of a large numerator relationship matrix. Biometrics, 32, 949–953.</p>
<p>Quaas, R.L. (1988) Additive genetic model with groups and relationships. Journal of Dairy Science, 71, 1338–1345.</p>
<p>Quaas, R.L. (1995) Fx algorithms. An unpublished note.</p>
<p>Reid, J.M. &amp; Keller, L.F. (2010) Correlated inbreeding among relatives: occurrence, magnitude, and implications. Evolution, 64, 973–985.</p>
<p>Robinson, G.K. (1986) Group effects and computing strategies for models for estimating breeding values. Journal of Dairy Science, 69, 3106–3111.</p>
<p>Schaeffer, L.R. (1991) C. R. Henderson: Contributions to predicting genetic merit. Journal of Dairy Science, 74, 4052–4066.</p>
<p>Schaeffer, L.R. (1994) Multiple-country comparison of dairy sires. Journal of Dairy Science, 77, 2671–2678.</p>
<p>Schaeffer, L.R. (1999) Phantom parents. An unpublished note.</p>
<p>Sullivan, P.G. (1999) Estimating Genetic Variances and Covariances for Models with Genetic Groups. <a href="http://cgil.uoguelph.ca/dcbgc/Agenda9909/agenda9909.htm" class="uri">http://cgil.uoguelph.ca/dcbgc/Agenda9909/agenda9909.htm</a>.</p>
<p>Westell, R.A., Quaas, R.L. &amp; Van Vleck, L.D. (1988) Genetic groups in an animal model. Journal of Dairy Science, 71, 1310–1318.</p>
<p>Wolak, M.E. (2012) nadiv: an R package to create relatedness matrices for estimating non-additive genetic variances in animal models. Methods in Ecology and Evolution, 3, 792–796.</p>
<p>Wolak, M.E. &amp; Keller, L.F. (2014) Dominance genetic variance and inbreeding in natural populations. Quantitative Genetics in the Wild (eds A. Charmantier, D. Garant &amp; L.E.B. Kruuk), pp. 104–127. Oxford University Press, Oxford.</p>
<p>Wolak, M.E. &amp; Reid, J.M. (2016) Data from: Accounting for genetic differences among unknown parents in microevolutionary studies: How to include genetic groups in quantitative genetic animal models. Journal of Animal Ecology, Dryad Digital Repository, <a href="http://dx.doi.org/10.5061/dryad.jf7cr" class="uri">http://dx.doi.org/10.5061/dryad.jf7cr</a>.</p>
<!----------------------------------------------------------------------------->
<!----------------------------------------------------------------------------->
<!----------------------------------------------------------------------------->
<h1 id="software-version-information">Software version information</h1>
<p>The following software versions were used to run all of the code above:</p>
<pre class="sourceCode r"><code class="sourceCode r">R.version.string</code></pre>
<pre><code>## [1] &quot;R version 3.3.2 (2016-10-31)&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">packageVersion</span>(<span class="st">&quot;nadiv&quot;</span>)</code></pre>
<pre><code>## [1] '2.14.3.1'</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">packageVersion</span>(<span class="st">&quot;MCMCglmm&quot;</span>)</code></pre>
<pre><code>## [1] '2.22.1'</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">packageVersion</span>(<span class="st">&quot;asreml&quot;</span>)</code></pre>
<pre><code>## [1] '3.0'</code></pre>
<p><strong>WOMBAT:</strong> Linux 64-bit version 12 June 2015, compiled using the <code>ifort</code> compiler with MKL library (threaded)</p>
<p><strong>ASReml:</strong> ASReml 4.10 [28 Dec 2014] lr [18 Mar 2015], from asreml-4.1.0.1051-lr.64.tgz</p>

</body>
</html>
